# 調査報告書: SONGSページのGrid表示化

## 調査日時
2025-10-03 10:42:32

## 調査対象
SONGSページのカード配列をリスト形式からGrid形式に変更

## 背景・要件
- 現在のSONGSページはリスト形式（1列）で表示
- Grid形式（複数列）で表示するように変更
- 共通コンポーネントのBaseGridを利用
- カードデザインは新規で作成

## 調査結果

### 1. 現状分析

#### 現在の実装
- コンポーネント: `src/features/songs/components/lists/StreamSongsList.tsx`
- 使用コンポーネント: `BaseGrid`
- Grid設定: `gridClassName="grid-cols-1 gap-1 sm:gap-4"`
- カードコンポーネント: `StreamSongListCard.tsx`
- カードレイアウト: 横長（サムネイル + 詳細情報が横並び）

#### データ構造
```typescript
interface StreamSong {
  id: string;
  title: string;
  artist: string;
  singCount: number;
  latestSingDate: string | null;
  performances: Performance[];
}

interface Performance {
  videoId: string;
  videoTitle: string;
  performanceType: PerformanceType;
  url: string;
  startSeconds: number;
  performedAt: string;
  streamSongUrl: string;
}
```

### 2. 参考実装調査

#### VideosGrid実装パターン
ファイル: `src/features/archives/components/grids/VideosGrid.tsx`

**実装の特徴:**
- `BaseGrid`を使用
- `gridConfig`をuseMemoでmemoized化
- `getVideoGridColumns()`で列設定を取得
- `generateGridClassName()`でレスポンシブクラス生成
- `renderItem`と`renderSkeleton`をuseCallbackでmemoized化

**Grid列設定:**
```typescript
const VIDEO_GRID_COLUMNS: GridColumnConfig = {
  sm: 2,    // モバイル: 2列
  md: 4,    // タブレット: 4列
  lg: 4,    // デスクトップ小: 4列
  xl: 4     // デスクトップ大: 4列
};
```

**コード例:**
```typescript
const gridConfig = useMemo(() => {
  const gridColumns = getVideoGridColumns();
  const gridClassName = generateGridClassName(gridColumns);
  return {
    columns: gridColumns,
    className: gridClassName.replace('grid ', '')
  };
}, []);

const renderItem = useCallback((video: VideoDto, index: number) => (
  <VideoCard key={video.id} video={video} index={index} />
), []);
```

### 3. 他の参考実装

#### SpecialsGrid
- Grid設定: `grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6`
- カード: 縦型レイアウト

#### DiscographyGrid
- Grid設定: `grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4`
- カード: 縦型レイアウト（アルバムカバー上、情報下）

### 4. 既存の共通コンポーネント

#### BaseGrid
ファイル: `src/components/Layout/BaseGrid.tsx`
- デフォルトGrid: `grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4`
- gridClassNameでカスタマイズ可能
- loading/error/empty状態の処理を内包

#### 共通カードコンポーネント
- `InteractiveCard`: ホバーエフェクト付きカード
- `StaggeredItem`: アニメーション付きアイテム

### 5. カードデザイン決定

ユーザーと協議の結果、以下のデザインに決定:

```
+-----------------------------+
|                             |
|   [YouTubeサムネイル]       |
|   (aspect-video 16:9)       |
|                             |
| 楽曲タイトル (2行まで)      |
| アーティスト名              |
| [歌唱回数] [最新歌唱日]     |
+-----------------------------+
```

**デザイン要素:**
- サムネイル: aspect-video (16:9)、YouTubeサムネイル画像
- 楽曲タイトル: font-bold, line-clamp-2
- アーティスト名: text-secondary, text-sm
- 統計情報: 歌唱回数アイコン + 数値、最新歌唱日アイコン + 日付
- ボーダー: カード全体を囲むのみ（内部区切り線なし）
- ホバー: scale-105, border-accent-gold/50

## 技術的制約・可能性

### 制約
- BaseGridの仕様に従う必要がある
- 既存のアニメーションシステム（StaggeredItem）を活用
- レスポンシブ対応が必須

### 可能性
- VideosGridのパターンを流用可能
- archivesのgridConfigとgridLayoutCalculatorを参照可能
- 既存の共通コンポーネントを最大限活用

## 既存システムとの整合性

### 問題なし
- BaseGridは既に他の機能で使用されており、動作実績あり
- InteractiveCard、StaggeredItemも広く使用されている
- generateGridClassNameは実績のあるユーティリティ

### 注意点
- StreamSongListCardは横長レイアウトのため、新規カード作成が必要
- SkeletonSongCardも横長レイアウトのため、修正が必要

## 解決方針

### 実装方針

1. **Grid設定の作成**
   - `src/features/songs/config/gridConfig.ts`を新規作成
   - VideosGridと同様のパターンで実装
   - Grid列設定: sm:2, md:3, lg:4, xl:4

2. **新しいGridカード作成**
   - `src/features/songs/components/cards/StreamSongGridCard.tsx`を新規作成
   - 縦型レイアウト
   - InteractiveCard + StaggeredItemを使用

3. **StreamSongsListの修正**
   - gridConfigをmemoized化
   - generateGridClassNameを使用
   - StreamSongGridCardを使用

4. **スケルトン修正**
   - `src/features/songs/components/cards/SkeletonSongCard.tsx`を修正
   - Grid用の縦型レイアウトに変更

5. **動作確認**
   - Playwrightでブラウザ確認
   - レスポンシブ動作確認
   - ホバーエフェクト確認

### ブランチ戦略
- ブランチ名: `feature/songs-grid-layout`
- mainブランチから作成

## 次フェーズ（Plan）への推奨事項

### 実装推奨
調査の結果、以下の理由で実装を推奨:
1. 技術的に実現可能
2. 既存パターン（VideosGrid）を流用できる
3. ユーザビリティの向上が期待できる
4. 既存システムとの整合性が取れている

### 実装ファイル
- 新規: `src/features/songs/config/gridConfig.ts`
- 新規: `src/features/songs/components/cards/StreamSongGridCard.tsx`
- 修正: `src/features/songs/components/lists/StreamSongsList.tsx`
- 修正: `src/features/songs/components/cards/SkeletonSongCard.tsx`

### 推奨作業順序
1. feature/songs-grid-layoutブランチ作成
2. gridConfig.ts作成
3. StreamSongGridCard.tsx作成
4. StreamSongsList.tsx修正
5. SkeletonSongCard.tsx修正
6. Playwrightで動作確認
7. コミット・プッシュ

## 参考リソース

### 参考ファイル
- `src/features/archives/components/grids/VideosGrid.tsx`
- `src/features/archives/config/gridConfig.ts`
- `src/features/archives/utils/gridLayoutCalculator.ts`
- `src/features/archives/components/cards/VideoCard.tsx`
- `src/components/Layout/BaseGrid.tsx`

### 関連型定義
- `src/features/songs/types/types.ts`
- `src/features/archives/types/specialGridTypes.ts`
