# 調査報告書: ResponsiveSidebar APIの統一化

## 調査日時
2025年9月25日 10:07:05

## 調査対象
- frontend/src/components/common/Sidebar/ResponsiveSidebar.tsx
- 関連するサイドバーコンポーネント群

## 問題の概要

### 現在の不一致
ResponsiveSidebarコンポーネントのAPIが、デスクトップ版とモバイル版で異なる扱い方をしている：

1. **デスクトップ版（children プロップス）**：
   - サイドバーコンポーネント全体を受け取る（FilterableSidebar → GenericSidebar を含む）
   - 呼び出し側でラップされた完全なコンポーネントを渡している

2. **モバイル版（mobileContent プロップス）**：
   - コンテンツのみを受け取る
   - ResponsiveSidebar内でBottomSheetでラップしている

### コード例
```tsx
// 現在の使用方法
<ResponsiveSidebar
  isOpen={isSidebarOpen}
  onClose={() => setIsSidebarOpen(false)}
  mobileContent={
    <CalendarBottomSheetContent />  // コンテンツのみ
  }
>
  <CalendarSidebar />  // サイドバー全体（GenericSidebarを含む）
</ResponsiveSidebar>
```

## 影響範囲

### 使用箇所（5ページ）
1. `/app/calendar/page.tsx`
2. `/app/songs/page.tsx`
3. `/app/news/page.tsx`
4. `/app/discography/page.tsx`
5. `/app/archives/page.tsx`

### 関連コンポーネント構造
```
ResponsiveSidebar
├── デスクトップ版
│   └── children (CalendarSidebar等)
│       └── FilterableSidebar
│           └── GenericSidebar
│               └── SidebarSection[]
└── モバイル版
    └── BottomSheet
        └── mobileContent (CalendarBottomSheetContent等)
```

## 技術的制約と可能性

### 制約
1. 既存の5ページすべてで使用されているため、影響範囲が広い
2. 各ページでSidebarとBottomSheetContentの2つのコンポーネントを管理している

### 可能性
1. APIを統一することで、コンポーネントの保守性が向上
2. デスクトップ/モバイル両方で同じコンテンツ構造を使用可能
3. 将来的な拡張が容易になる

## 解決方針

### 推奨される実装方法
1. **ResponsiveSidebarの改修**：
   - `children`を`desktopContent`に変更
   - 両方ともコンテンツのみを受け取る
   - ResponsiveSidebar内でGenericSidebarとBottomSheetでラップ

2. **使用側の簡素化**：
   - XxxSidebarコンポーネントを削除または簡素化
   - セクション情報を直接渡す

### 実装後のコード例
```tsx
// 改修後の使用方法
<ResponsiveSidebar
  isOpen={isSidebarOpen}
  onClose={() => setIsSidebarOpen(false)}
  desktopContent={<CalendarContent />}  // コンテンツのみ
  mobileContent={<CalendarContent />}    // コンテンツのみ
/>
```

## リスク評価
- **低リスク**：ロジックの変更はなく、構造の再編成のみ
- **中程度の作業量**：5ページの更新が必要
- **高い価値**：コードの一貫性と保守性が大幅に向上

## 次のステップ
1. PLANフェーズでの詳細設計
2. 各ページの段階的な更新
3. 動作確認とテスト

## ブランチ情報
- ブランチ名: `feature/sidebar-refactor`
- 基準ブランチ: `main`

## 結論
ResponsiveSidebarのAPIを統一することで、コードベースの一貫性を向上させることができる。技術的な制約は少なく、実装価値が高い改修である。