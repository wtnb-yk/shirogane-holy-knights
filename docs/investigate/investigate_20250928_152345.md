# 調査報告書: フッターモバイル背景表示問題

## 調査概要
- **調査日時**: 2025-09-28 15:23:45
- **調査対象**: フッターが画面下端まで表示されない問題
- **ブランチ**: feature/footer-mobile-background-fix

## 問題の詳細

### ユーザー報告
- フッターが画面で見た時に下端まで表示されない
- スマホで見るとURLバーの上にフッターが来るのは良い
- 背景は下端まで表示されてほしい

### 技術的問題
モバイルブラウザでフッターの背景色が画面最下端まで到達せず、SafeArea分の空白が生じている。

## 調査結果

### 1. 現在の実装状況

#### Footer.tsx (/Users/yuki_watanabe/My/shirogane-holy-knights/frontend/src/components/footer/Footer.tsx:8)
```tsx
<div className="w-full pt-4 pb-4 pb-safe px-4 sm:px-6 lg:pt-8 lg:pb-5 lg:px-10">
```

#### layout.tsx (/Users/yuki_watanabe/My/shirogane-holy-knights/frontend/src/app/layout.tsx:68)
```tsx
<body className={`min-h-screen min-h-[100dvh] flex flex-col ${mplusRounded.variable} ${notoSansJP.variable}`}>
```

### 2. 根本原因分析

**主要原因:**
- Footer内の`div`要素に`pb-safe`クラスが適用
- SafeArea対応によりpadding-bottomが追加される結果、footer背景が画面最下端まで到達しない
- footer要素自体は`bg-bg-secondary`背景色を持つが、内部のdivのpaddingにより空白が生じる

**技術的制約:**
- モバイルブラウザのURL バーの動的変化
- SafeArea対応（ホームインジケーターなど）
- 既存の`100dvh`によるViewport Height対応

### 3. 既存システムとの整合性

**プロジェクト特徴:**
- Next.js App Router + TailwindCSS v4.0
- カスタムカラーパレット使用（`--color-bg-secondary`など）
- 完全なレスポンシブデザイン対応
- 動的Viewport Height対応済み（`100dvh`、CSS変数`--viewport-height`）

**SafeArea対応の現状:**
- globals.css内に動的ビューポート高さ対応のユーティリティクラス定義済み
- `pb-safe`クラスによる適切な安全領域対応実装済み

## 解決方針

### 構造的アプローチ
1. **背景と内容の分離**: footer要素の背景は最下端まで、内容のみ安全領域内配置
2. **CSS階層化**: footer要素の背景拡張、内部divの適切な配置
3. **SafeArea配慮**: 内容の安全性を保ちつつ背景の視覚的連続性確保

### 具体的修正方針
1. footer要素に`pb-env(safe-area-inset-bottom, 0)`適用またはカスタムクラス追加
2. 内容div要素から`pb-safe`除去
3. 新しい安全領域対応クラスの追加検討

### 実装手順
1. `feature/footer-mobile-background-fix`ブランチ作成
2. Footer.tsx修正
3. 必要に応じてglobals.cssに新しいユーティリティクラス追加
4. PlaywrightによるE2Eテスト実施
5. モバイルデバイスでの動作確認

## 技術的考慮事項

### 互換性
- iOS Safari、Android Chrome対応
- Safe Area Inset対応
- 既存のレスポンシブデザインとの整合性維持

### パフォーマンス
- 既存CSS構造への影響最小化
- 追加CSSの最適化

### 保守性
- コンポーネント構造の単純性維持
- 将来的なSafeArea仕様変更への対応容易性

## 次フェーズ推奨事項

### PLAN フェーズで実施すべき事項
1. 詳細な実装計画策定
2. テストケース設計
3. リスク評価と対策立案
4. 実装優先度設定

### リスク要因
- SafeArea対応の既存機能への影響
- 他ページのフッター表示への影響
- 異なるデバイス・ブラウザでの表示差異

## 結論

**実装推奨度**: 高
**実装複雑度**: 低
**影響範囲**: Footer.tsx + 必要に応じてCSS追加

問題は明確に特定され、技術的に実現可能な解決方針が確立された。既存システムとの整合性を保ちながら、ユーザーが期待する背景表示を実現できる。