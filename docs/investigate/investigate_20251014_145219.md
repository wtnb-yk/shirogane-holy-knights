# 調査報告書

## 調査日時
2025-10-14 14:52:19

## 調査対象
- event_typesとnews_categoriesのバッチやバーの色の統一
- news_categoriesのmediaカテゴリの削除

## 調査結果

### 1. カテゴリと色の現状

#### event_types (カレンダー機能)
現在のevent_typesと色の対応 (frontend/src/features/calendar/utils/eventUtils.ts:3-19):

| type | 色 |
|------|-----|
| event | blue |
| goods | orange |
| campaign | green |
| collaboration | purple |
| others | gray |

#### news_categories (ニュース機能)
現在のnews_categoriesと色の対応 (frontend/src/features/news/utils/categoryStyles.ts:3-19):

| category | 色 |
|----------|-----|
| goods | blue |
| collaboration | green |
| event | orange |
| media | purple |
| campaign | pink |
| others | gray |

### 2. 色の不一致の問題点

同じ意味のカテゴリなのに色が異なる状態:
- **event**: カレンダーではblue、ニュースではorange
- **goods**: カレンダーではorange、ニュースではblue
- **collaboration**: カレンダーではpurple、ニュースではgreen
- **campaign**: カレンダーではgreen、ニュースではpink

### 3. mediaカテゴリの調査結果

#### データベースの状態
- backend/src/main/resources/db/changelog/changes/004-create-news-tables.sql:46 で初期データとして'MEDIA'が挿入
- backend/src/main/resources/db/changelog/changes/013-insert-initial-news-categories.sql:16 で'media'に更新

#### 使用状況
- tools/data/news.csv を確認した結果、実際のニュースデータでは'メディア'カテゴリは使用されていない
- 全40件のニュースレコードで使用されているカテゴリは以下のみ:
  - グッズ、コラボ、イベント、キャンペーン、その他

#### コードでの定義
- frontend/src/constants/newsCategories.ts:4 - NewsCategory enum にMEDIAが定義されている
- frontend/src/features/news/utils/categoryStyles.ts:11-12 - MEDIA用の色定義(purple)が存在

### 4. 技術的制約と可能性

#### 修正が必要なファイル

**フロントエンド:**
1. frontend/src/features/calendar/utils/eventUtils.ts
   - getEventColor関数の色マッピングを変更

2. frontend/src/constants/newsCategories.ts
   - NewsCategory enumからMEDIAを削除
   - CATEGORY_DISPLAY_NAMESからMEDIAを削除

3. frontend/src/features/news/utils/categoryStyles.ts
   - getCategoryBadgeStyle関数からMEDIA caseを削除
   - getCategoryButtonStyle関数からMEDIA caseを削除

**バックエンド:**
4. 新しいマイグレーションファイルの作成
   - backend/src/main/resources/db/changelog/changes/033-remove-media-category.sql
   - news_categoriesテーブルから'media'レコードを削除

### 5. 既存システムとの整合性

#### 影響範囲の分析
- **データベース**: news_categoriesテーブルから'media'レコードを削除しても、実際のニュースデータでは使用されていないため影響なし
- **API**: 既存のニュースデータには影響なし
- **UI**: MEDIA関連のケースを削除しても、実際に表示されるニュースには影響なし
- **型定義**: TypeScriptのenum削除により、コンパイル時にMEDIAを使用している箇所があればエラーとなる（安全）

#### 後方互換性
- 既存のニュースデータは全て残存するカテゴリ(goods, collaboration, event, campaign, others)のため問題なし

### 6. 問題の根本原因

#### 色の不統一
- カレンダー機能とニュース機能が異なる時期に開発された
- 色の定義を統一する共通の定数ファイルが存在しない
- event_typesとnews_categoriesで同じ概念のカテゴリに異なる色が割り当てられた

#### mediaカテゴリの未使用
- 初期設計では'メディア'カテゴリが想定されていた
- 実際の運用では'メディア'に該当するニュースが投稿されなかった
- 削除されずにコードとDBに残存している

### 7. 解決方針

#### 色の統一方針
ニュース側(NEWS)の配色に統一する:
- event: blue → **orange**
- goods: orange → **blue**
- collaboration: purple → **green**
- campaign: green → **pink**
- others: gray (変更なし)
- 新規追加: **others** (gray)

#### mediaカテゴリの削除方針
以下の順序で削除:
1. フロントエンドのTypeScript定義から削除
2. フロントエンドの色定義から削除
3. データベースからレコード削除（マイグレーション）

### 8. 実装手順

1. event_typesの色をnews_categoriesに統一
   - frontend/src/features/calendar/utils/eventUtils.tsを修正
   - getEventColor関数内の色マッピングを変更

2. news_categoriesのmediaを削除
   - frontend/src/constants/newsCategories.tsから削除
   - frontend/src/features/news/utils/categoryStyles.tsから削除
   - 新しいマイグレーションファイル作成

3. 動作確認
   - Playwright MCPツールでカレンダーページを確認
   - Playwright MCPツールでニュースページを確認
   - バッジとバーの色が統一されていることを確認

4. コミット
   - 変更内容をコミット

### 9. リスク評価

#### 低リスク
- mediaカテゴリは実際に使用されていないため、削除しても影響なし
- 色の変更はUI上の見た目のみで、機能に影響なし

#### 注意点
- カレンダーの既存イベントの色が変わるため、ユーザーが一時的に違和感を覚える可能性がある
- 色の変更により、アクセシビリティ（色覚特性）への配慮が必要（既存の色選択が適切であることを前提とする）

### 10. 次フェーズへの推奨事項

- Planフェーズで詳細な実装計画を策定
- Implementフェーズで実装と動作確認を実施
- 必要に応じてカラーパレットの統一を検討（将来的な課題）
