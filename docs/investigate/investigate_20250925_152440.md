# PageLayout責務整理調査結果

## 調査概要
- **調査日時**: 2025年9月25日 15:24:40
- **調査対象**: PageLayoutのmobileActionsとsidebarの責務整理
- **ブランチ**: feature/sidebar-responsibilities

## 現在の問題点

### 1. 責務の重複と複雑性
- **PageLayout**: `sidebar`と`mobileActions`という2つの異なるプロパティで画面幅対応
- **ResponsiveSidebar**: 内部で`desktopContent`と`mobileContent`を管理し、画面幅による表示切り替えを実行
- **結果**: 画面幅に関する責務がPageLayoutとResponsiveSidebarで重複

### 2. APIの一貫性不足
```typescript
// 現在のPageLayoutProps
interface PageLayoutProps {
  sidebar?: React.ReactNode;        // デスクトップ用？モバイル用？不明確
  mobileActions?: React.ReactNode;  // モバイル専用
}
```

### 3. 実装パターンの分析

#### デスクトップでのモーダル使用パターン
- **songs/page.tsx**: `SongSearchOptionsModal`（検索オプション詳細設定）
- **calendar/page.tsx**: `DayEventsModal`、`EventDetailModal`（日付詳細、イベント詳細）

#### ResponsiveSidebarの利用状況
以下のページで使用されていることを確認：
- `/app/songs/page.tsx`
- `/app/calendar/page.tsx`
- `/app/news/page.tsx`
- `/app/discography/page.tsx`
- `/app/archives/page.tsx`

## 技術的制約・可能性

### 既存コンポーネントの再利用性
- **GenericSidebar**: デスクトップ用サイドバーレイアウト（再利用可能）
- **BottomSheet**: モバイル用ボトムシート（再利用可能）
- **FilterToggleButton**: モバイル用フィルターボタン（再利用可能）

### Tailwind CSSによる画面幅制御
現在の実装では`hidden lg:block`や`lg:hidden`を使用した表示制御が確立されている

## 根本原因の特定

1. **設計時の責務分離不足**: PageLayoutとResponsiveSidebarで画面幅対応が重複
2. **プロパティ命名の曖昧性**: `sidebar`が何を指すのか不明確
3. **関連性の可視化不足**: デスクトップサイドバーとそのモーダルの関係性が見えにくい

## 解決方針

### 新しいPageLayoutインターフェース設計
```typescript
interface PageLayoutProps {
  title: string;
  description: React.ReactNode;
  children: React.ReactNode;
  primaryTabs?: React.ReactNode;

  // デスクトップサイドバー関連（必須）
  desktopSidebar: {
    content: React.ReactNode;
    // サイドバーに関連するモーダル（SearchOptionsModal等）
    modal?: {
      isOpen: boolean;
      onClose: () => void;
      content: React.ReactNode;
    };
  };

  // モバイル用（必須）
  mobileBottomSheet: {
    trigger: React.ReactNode;  // FilterToggleButton等
    isOpen: boolean;
    onClose: () => void;
    title?: string;
    content: React.ReactNode;
  };
}
```

### 実装方針
1. **PageLayoutが画面幅対応を一元管理**: ResponsiveSidebarの機能をPageLayout内に統合
2. **関連性の明確化**: デスクトップサイドバーとそのモーダルを同一プロパティ内で管理
3. **必須パラメータ化**: desktopSidebarとmobileBottomSheetを必須として安全性向上

## 期待される効果

### メリット
- **責務の明確化**: PageLayoutが画面幅対応を一元管理
- **関連性の可視化**: サイドバーとそのモーダルの関係が明確
- **API簡潔化**: desktopSidebar/mobileBottomSheetという直感的な構造
- **保守性向上**: ResponsiveSidebarの複雑なロジックを削除
- **型安全性**: 必須パラメータによる実装ミス防止

### 既存システムとの整合性
- 既存のGenericSidebar、BottomSheet、FilterToggleButtonはそのまま利用可能
- 各ページの機能的な変更は不要（構造のみ変更）

## 次フェーズ（Plan）への推奨事項

1. **段階的移行**: 1ページずつ新しいPageLayoutに移行
2. **ResponsiveSidebarの段階的廃止**: 移行完了後に削除またはdeprecated化
3. **動作確認**: 各画面幅でのサイドバーとモーダルの表示確認
4. **E2Eテスト**: ユーザー操作フローの動作確認

## 結論

**status: COMPLETED**
**next: PLAN**
**details**: 調査完了。feature/sidebar-responsibilitiesブランチ作成済み。docs/investigate/investigate_20250925_152440.mdに詳細記述。実装方針策定を推奨。