# EventDetailHeader修正に関する調査報告

## 調査日時
2025年09月27日 21:53:03

## 調査対象・スコープ
frontend/src/features/calendar/components/modals/EventDetailModal.tsxのEventDetailHeaderの削除と戻る機能の統合

## 現状分析

### 現在の構成
1. **EventDetailModal.tsx**
   - ResponsiveModalを使用してモーダル表示
   - EventDetailHeaderで戻るボタンを実装
   - fromDayModal/onBackToDayModalプロパティで戻る機能を制御

2. **EventDetailHeader.tsx**
   - ChevronLeftアイコンによる戻るボタン
   - fromDayModal条件で戻るボタンの表示制御
   - TODOコメントあり（戻るボタンの実装）

3. **ResponsiveModal.tsx**
   - デスクトップ：Modal使用
   - モバイル：BottomSheet使用
   - titleプロパティでヘッダータイトル設定

4. **Modal.tsx / BottomSheet.tsx**
   - それぞれModalHeader / BottomSheetHeaderを使用
   - 共通のヘッダー構造（タイトル + 閉じるボタン）

### 問題の根本原因
- ResponsiveModalのヘッダーが復活したため、EventDetailHeaderと重複
- EventDetailHeaderの削除により戻る機能が失われる
- ユーザビリティの低下（DayEventsModal → EventDetailModalの遷移）

## 技術的制約・可能性

### 制約
1. ResponsiveModalは複数箇所で使用されている
   - DayEventsModal.tsx
   - SongDetailModal.tsx
   - 後方互換性を保つ必要あり

2. ModalHeader/BottomSheetHeaderの構造
   - 現在はタイトル + 閉じるボタンのみ
   - 戻るボタンの追加にはレイアウト調整が必要

### 可能性
1. ResponsiveModalの拡張
   - backButtonプロパティの追加
   - コールバック関数による戻る処理

2. ヘッダーコンポーネントの修正
   - 条件付き戻るボタンの表示
   - レイアウトの最適化

## 既存システムとの整合性

### 他のModalコンポーネントへの影響
- DayEventsModal：戻るボタン不要のため影響なし
- SongDetailModal：戻るボタン不要のため影響なし
- 新機能は任意プロパティとして実装すれば既存機能に影響なし

### カレンダーページでの使用状況
- EventDetailModalは以下の場面で使用：
  - 直接イベントクリック
  - DayEventsModalからの遷移
  - fromDayModal/onBackToDayModalで制御

## 解決方針

### 推奨アプローチ
1. ResponsiveModalに`backButton`プロパティを追加
2. ModalHeader/BottomSheetHeaderに戻るボタンを条件付き表示
3. EventDetailHeaderを削除
4. EventDetailModalで新しいbackButtonプロパティを使用

### 実装ステップ
1. ResponsiveModal.tsxの拡張
   - backButtonプロパティ追加
   - ヘッダーコンポーネントに戻るボタン情報渡し

2. ModalHeader.tsx/BottomSheetHeader.tsxの修正
   - 戻るボタンの条件付き表示
   - レイアウト調整（戻るボタン + タイトル + 閉じるボタン）

3. EventDetailModal.tsxの修正
   - EventDetailHeaderの削除
   - ResponsiveModalのbackButtonプロパティ使用

4. 動作確認
   - デスクトップ/モバイル両方での表示確認
   - DayEventsModal → EventDetailModalの遷移フローテスト

## リスク評価

### 低リスク
- 新機能は任意プロパティのため既存機能への影響は最小限
- 現在のブランチfeature/calendar-responsive-modalで実装可能

### 注意点
- レイアウト調整時のデザイン一貫性
- モバイル/デスクトップでの表示確認
- 戻るボタンのアクセシビリティ対応

## 次フェーズへの推奨事項
1. 実装フェーズ（PLAN）で詳細設計
2. E2Eテストでユーザーフローの確認
3. デザインレビューでUI/UX確認

## 結論
EventDetailHeaderの削除は技術的に実現可能。ResponsiveModalの拡張により戻る機能を統合し、重複ヘッダー問題を解決できる。既存システムへの影響は最小限で、後方互換性を保ちながら実装可能。