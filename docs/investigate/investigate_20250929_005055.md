# 調査レポート: コンポーネントディレクトリ構造の再編成

## 調査日時
2025-09-29 00:50:55

## 調査概要
frontend/src/componentsディレクトリ内のui/とcommon/にあるコンポーネントを、より管理しやすい構造に再編成するための調査を実施。

## 現状分析

### 現在のディレクトリ構造の問題点

#### ui/ディレクトリ（23個のコンポーネント）
- フラットな構造で機能別の整理がされていない
- Button, Modal, Card, Input系などが混在
- 関連コンポーネント間の関係性が不明確

#### common/ディレクトリ（18個のファイル + 3つのサブディレクトリ）
- トップレベルに多数のファイルが散在
- BottomSheet/, Sidebar/, SearchOptionsModal/のみサブディレクトリ化
- 機能的な分類基準が不明確

### 良い例として参考にすべき既存構造
- **header/**: Header.tsx + internals/で内部コンポーネントを整理
- **footer/**: シンプルだが明確な構造
- **BottomSheet/**: 関連コンポーネントをまとめて管理

## 技術的制約

### TypeScript設定
- パスエイリアス設定: `@/components/*` が設定済み
- 約150箇所のimport文の更新が必要

### 影響範囲
- 84ファイルで149箇所のimportが影響を受ける
- components/index.tsのexport文の全面改修が必要

## 解決方針

### コンポーネントの抽象度を上げたグループ化

コンポーネントを機能・用途別に以下の21カテゴリに分類:

1. **Button/** - ボタン系コンポーネント（Button, FilterToggleButton, SearchOptionsButton, ModalButton）
2. **Input/** - 入力系コンポーネント（SearchInput, DateInput, DateRangeInput, SegmentedControl）
3. **Select/** - 選択系コンポーネント（Select, MultiSelect, MultiSelectSection）
4. **Card/** - カード系表示（Card, InteractiveCard, StaggeredItem）
5. **Modal/** - モーダル・ダイアログ系（Modal, ResponsiveModal, ModalHeader, SearchOptionsModal/）
6. **Overlay/** - オーバーレイ系（Overlay, OverlayIcon）
7. **List/** - リスト表示系（SelectableList, SelectableListHeader, SelectableListItem）
8. **Layout/** - ページレイアウト系（PageLayout, PageTitle, BaseGrid）
9. **Navigation/** - ナビゲーション系（Pagination, LinkText）
10. **Badge/** - バッジ表示
11. **Image/** - 画像表示（OptimizedImage）
12. **Loading/** - ローディング・スケルトン系（LoadingState, BaseSkeleton, Skeleton）
13. **Error/** - エラー表示・処理系（ErrorDisplay, ErrorBoundary）
14. **Feedback/** - ユーザーフィードバック系（Toast, Tooltip, OfflineIndicator）
15. **Stats/** - 統計・サマリー表示系（StatsSummary, SearchResultsSummary）
16. **Section/** - セクション・区切り系（各種PresetsSection, BottomSheetSectionHeader）
17. **BottomSheet/** - ボトムシート（既存構造維持）
18. **Sidebar/** - サイドバー関連
19. **Header/** - ヘッダー（既存構造維持）
20. **Footer/** - フッター（既存構造維持）
21. **Misc/** - その他（DynamicComponents, FloatingYouTubeLink）

### 実装の利点
- コンポーネントの種類が一目で分かる
- 関連コンポーネントがまとまっているため保守しやすい
- 新しいコンポーネント追加時の配置場所が明確
- import文が意味的に整理される

## 実装計画

### フェーズ1: ディレクトリ構造の作成
1. 新しいディレクトリ構造を作成
2. 各カテゴリのディレクトリを設置

### フェーズ2: コンポーネントの移動
1. ui/内のコンポーネントを適切なディレクトリへ移動
2. common/内のコンポーネントを適切なディレクトリへ移動
3. Sidebar/内のコンポーネントを再配置

### フェーズ3: import文の更新
1. components/index.tsの更新
2. 全プロジェクトのimport文を新しいパスに更新（約150箇所）

### フェーズ4: 検証
1. TypeScriptビルドチェック
2. 型チェック（npm run typecheck）
3. リンター実行（npm run lint）
4. Playwrightでの動作確認

## リスクと対策

### リスク
1. 大量のimport文変更によるエラー
2. 相対パスの誤り
3. export漏れ

### 対策
1. 段階的な移行とビルドチェック
2. TypeScriptの型チェックを活用
3. components/index.tsの慎重な更新

## 推奨事項

### 次フェーズ（Plan）への推奨
1. feature/component-directory-restructureブランチで作業
2. 各フェーズごとにコミット
3. 移行スクリプトの作成を検討
4. 影響を受けるファイルのリストを事前に作成

### 長期的な改善案
1. 各ディレクトリにindex.tsを配置してバレルエクスポート
2. Storybookでのコンポーネントカタログ作成
3. コンポーネント命名規則のドキュメント化

## 結論
ui/とcommon/を廃止し、コンポーネントを機能別に21のカテゴリに再編成することで、より管理しやすく、拡張性の高いディレクトリ構造を実現できる。