# Calendar コンポーネントリファクタリング調査結果

## 調査日時
2025-09-25 00:17:00

## 調査背景
frontend/src/app/calendar/page.tsxのCalendarHeaderとCalendarGridを一つのCalendarコンポーネントとしてリファクタリングする要件について調査実施。

## 現在の構造分析

### 1. calendar/page.tsx の現状
- CalendarHeaderとCalendarGridを個別にimportして使用
- useCalendarフックから状態を取得
- 154行目～179行目でCalendarHeaderとCalendarGridを個別にレンダリング

### 2. 関連コンポーネント構造
```
CalendarHeader: frontend/src/features/calendar/components/CalendarHeader.tsx
- 日付表示、ナビゲーション、今日への移動機能
- props: currentView, currentDate, onDateChange

CalendarGrid: frontend/src/features/calendar/components/CalendarGrid.tsx
- カレンダー本体の表示
- MonthViewコンポーネントを内部で使用
- props: currentView, currentDate, events, loading, error, onEventClick, onDateClick, onMobileDateClick
```

### 3. 技術的制約
- React 19.1.1, Next.js 15.1.6使用
- TypeScript, Tailwind CSS使用
- 既存のコンポーネント設計パターンに準拠必要

### 4. 既存システムとの整合性
- 他のfeature（news, archives, songs等）でも類似のパターンを使用
- FilterableSidebar等の共通コンポーネントとの統合
- PageLayoutコンポーネントとの親子関係を維持

## 解決方針

### 1. 新規Calendarコンポーネント作成
- `Calendar.tsx`として統合コンポーネントを新規作成
- CalendarHeaderとCalendarGridの機能を内包
- 単一のpropsインターフェースで管理

### 2. 統合後のインターフェース設計
```typescript
interface CalendarProps {
  // Header関連
  currentView: CalendarView;
  currentDate: Date;
  onDateChange: (date: Date) => void;

  // Grid関連
  events: Event[];
  loading?: boolean;
  error?: string | null;
  onEventClick: (event: Event) => void;
  onDateClick: (date: Date, events: Event[]) => void;
  onMobileDateClick?: (date: Date, events: Event[]) => void;
}
```

### 3. 既存コンポーネントの保持
- CalendarHeaderとCalendarGridは引き続き存在
- 新しいCalendarコンポーネント内で内部的に使用
- 後方互換性を維持

## 実装ステップ
1. feature/calendar-refactorブランチ作成 ✅
2. Calendar.tsxコンポーネント新規作成
3. CalendarPropsインターフェース定義
4. calendar/page.tsxの更新
5. PlaywrightでE2Eテスト実施
6. コードレビュー・マージ

## 影響範囲
- ✅ frontend/src/app/calendar/page.tsx（更新対象）
- ✅ frontend/src/features/calendar/components/Calendar.tsx（新規作成）
- ❌ 他のコンポーネントへの影響なし

## リスク評価
- **低リスク**: 既存コンポーネントは保持されるため、破壊的変更なし
- **互換性**: 新しいコンポーネントは既存の設計パターンに準拠
- **テスト**: PlaywrightによるE2Eテストで動作確認実施

## 次フェーズ推奨事項
実装フェーズ（PLAN）への移行を推奨。調査結果に基づき、リスクは低く実装可能。