# Modalコンポーネントスクロール問題調査レポート

## 調査日時
2025年9月27日 22:37:28

## 調査対象
Modalコンポーネントで縦幅が長いとモーダル全体がスクロールしてしまう問題

## 問題の詳細
- 現状：モーダルのコンテンツが長い場合、モーダル全体がスクロールする
- 期待：ヘッダーは固定し、コンテンツ部分のみがスクロールする

## 調査結果

### 1. 現在のModalコンポーネント構造

#### Modal.tsx (主要部分)
- ファイル位置: `/frontend/src/components/ui/Modal.tsx`
- 問題箇所: 63-75行目
- 現在の実装:
  ```tsx
  <div
    className={`relative w-full max-w-lg sm:max-w-xl md:max-w-2xl lg:max-w-4xl xl:max-w-5xl mx-auto max-h-[85vh] sm:max-h-[90vh] overflow-y-auto pointer-events-auto bg-bg-primary ${
      isVisible ? 'animate-modal-slide-scale' : 'animate-modal-slide-scale-out'
    }`}
  >
    <ModalHeader title={title} onClose={handleClose} backButton={backButton} />
    <div className="px-4 pb-4 sm:px-6 sm:pb-6">
      {children}
    </div>
  </div>
  ```

### 2. BottomSheetコンポーネントの正しい実装

#### BottomSheet.tsx (参考実装)
- ファイル位置: `/frontend/src/components/common/BottomSheet/BottomSheet.tsx`
- 正しい構造 (62-80行目):
  ```tsx
  <div className={cn(
    'fixed bottom-0 left-0 right-0 w-full bg-white shadow-2xl z-[51]',
    'rounded-t-3xl',
    'animate-in slide-in-from-bottom-2 duration-300',
    'flex flex-col',
    'max-h-[calc(100vh-64px)]',
    'overflow-hidden'
  )}>
    <BottomSheetHeader />
    <div className="flex-1 overflow-y-auto min-h-0">
      <div className="px-4 pb-4">
        {children}
      </div>
    </div>
  </div>
  ```

### 3. 関連コンポーネント分析

#### ResponsiveModal.tsx
- デスクトップ: Modal.tsxを使用
- モバイル: BottomSheet.tsxを使用
- 一貫性のあるスクロール動作が必要

#### Modal使用箇所
1. DiscographyDetailModal.tsx - 直接Modal使用
2. SearchOptionsModal.tsx - 直接Modal使用
3. EventDetailModal.tsx - ResponsiveModal経由
4. DayEventsModal.tsx - ResponsiveModal経由
5. SongDetailModal.tsx - ResponsiveModal経由

### 4. 技術的制約・可能性

#### CSS構造の要件
- `flex flex-col`: 縦方向のflexコンテナ
- `overflow-hidden`: 全体のスクロール無効化
- `flex-1 overflow-y-auto min-h-0`: コンテンツ部分のスクロール有効化

#### 既存アニメーションとの互換性
- `animate-modal-slide-scale`アニメーションは維持可能
- CSSクラスの変更のみで対応可能

### 5. 問題の根本原因
Modal.tsxで`overflow-y-auto`がモーダル全体に適用されているため、ヘッダーも含めた全体がスクロール対象となっている。

### 6. 解決方針
BottomSheet.tsxの実装パターンをModal.tsxに適用:
1. モーダル全体を`flex flex-col overflow-hidden`に変更
2. ヘッダー部分は`flex-shrink-0`で固定
3. コンテンツ部分を`flex-1 overflow-y-auto min-h-0`でスクロール有効化

### 7. 既存システムとの整合性
- ResponsiveModalのAPIは変更不要
- 各モーダルコンポーネントのAPIは変更不要
- 破壊的変更なし

## 実装推奨事項

### 優先度: 高
- Modal.tsxのCSS構造修正
- 全モーダルでの動作確認
- PlaywrightによるE2Eテスト実行

### 期待される効果
- ユーザビリティの向上（ヘッダー固定）
- モバイル・デスクトップ間の一貫性確保
- 既存機能の互換性維持

## 結論
調査完了。技術的に実装可能であり、既存システムとの互換性も確保できる。BottomSheetの実装パターンを適用することで問題解決が可能。

## 次フェーズ
PLAN - 具体的な実装手順の策定を推奨