# DayEventsModal ResponsiveModal対応 調査報告書

**調査日時**: 2025/09/27 18:55:45
**ブランチ**: feature/calendar-responsive-modal
**担当**: Claude Code

## 調査概要

### 背景・目的
- CalendarページのDayEventsModalコンポーネントにResponsiveModal対応を実装する
- EventDetailModalで実装済みのパターンを適用し、一貫性のあるUXを提供する
- デスクトップではモーダル、モバイルではボトムシートとして表示する

### 調査スコープ
1. DayEventsModalの現状実装調査
2. EventDetailModalの実装パターン分析
3. 技術的制約と実装可能性の確認
4. 既存システムとの整合性確認

## 現状分析

### DayEventsModalの現状
**ファイル**: `frontend/src/features/calendar/components/modals/DayEventsModal/DayEventsModal.tsx`

**現在の実装**:
- Modal + ModalContentコンポーネントを使用
- 日付ごとのイベント一覧を表示
- EventDetailModalへの遷移機能を持つ

**主要コンポーネント構成**:
- DayEventsHeader: 日付ヘッダー表示
- DayEventsList: イベント一覧表示
- EmptyEventsMessage: イベントなし時のメッセージ

**プロパティ**:
```typescript
interface DayEventsModalProps {
  date: Date | null;
  events: Event[];
  isOpen: boolean;
  onClose: () => void;
  onEventClick: (event: Event) => void;
}
```

### EventDetailModalの実装パターン
**ファイル**: `frontend/src/features/calendar/components/modals/EventDetailModal/EventDetailModal.tsx`

**実装済みのパターン**:
1. ResponsiveModalの使用
2. useViewportフックによるデバイス判定
3. SSRハイドレーション対応（`!isLoaded || isDesktop`）
4. 条件付きタイトル表示（デスクトップ時のみ）

## 技術的分析

### 必要な変更点
1. **インポートの変更**
   - 削除: `Modal`, `ModalContent` from '@/components/ui/Modal'
   - 追加: `ResponsiveModal` from '@/components/ui/ResponsiveModal'
   - 追加: `useViewport` from '@/hooks/useViewport'

2. **コンポーネント実装の変更**
   - useViewportフックの使用
   - shouldUseDesktopLayoutロジックの実装
   - ResponsiveModalへの置き換え

3. **プロパティマッピング**
   - isOpen → isOpen（変更なし）
   - onClose → onClose（変更なし）
   - title → 条件付き設定（デスクトップ時のみ日付を表示）
   - className → 条件付き設定

### 依存関係
- ResponsiveModal: 実装済み、動作確認済み
- useViewport: 実装済み、動作確認済み
- BottomSheet: ResponsiveModal内で使用、動作確認済み

## 実装可能性評価

### 技術的制約
- なし（必要な全コンポーネントが実装済み）

### リスク評価
- **低リスク**: EventDetailModalで実証済みのパターンを適用
- **互換性**: 既存のプロパティと完全互換

### 影響範囲
- **直接影響**: DayEventsModal.tsxのみ
- **間接影響**: なし（親コンポーネントからの呼び出しは変更不要）

## 実装方針

### Phase 1: 基本実装
1. DayEventsModal.tsxの修正
   - インポート変更
   - useViewportフック導入
   - ResponsiveModal実装

### Phase 2: テスト・検証
1. TypeScriptビルド確認
2. デスクトップ/モバイル表示確認
3. EventDetailModalとの連携確認

### Phase 3: 最適化（オプション）
1. モバイル専用レイアウト最適化
2. タッチ操作の改善

## 推奨事項

### 実装推奨
EventDetailModalと同一パターンでの実装を推奨。以下の理由による：
1. 実証済みのパターンでリスクが低い
2. コードの一貫性が保たれる
3. ユーザー体験の統一性

### 実装時の注意点
1. SSRハイドレーション対応を確実に実装する
2. 既存機能（EventDetailModalへの遷移）の動作保証
3. タイトル表示の条件分岐を適切に設定

## 関連ファイル

### 参考実装
- `frontend/src/features/calendar/components/modals/EventDetailModal/EventDetailModal.tsx`
- `frontend/src/features/songs/components/modals/SongDetailModal.tsx`
- `frontend/src/components/ui/ResponsiveModal.tsx`
- `frontend/src/hooks/useViewport.ts`

### 関連ドキュメント
- `docs/implement/implement_20250926_143021.md`: EventDetailModal実装詳細

## 結論

DayEventsModalのResponsiveModal対応は技術的に問題なく実装可能。EventDetailModalで実証済みのパターンを適用することで、低リスクかつ迅速な実装が期待できる。

**次フェーズ**: PLAN（実装計画の詳細化）

---

**調査ステータス**: 完了
**ブランチ**: feature/calendar-responsive-modal（既存使用）