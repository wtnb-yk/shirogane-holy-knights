# z-index管理標準化調査

## 調査日時
2025-09-27 23:42:07

## 調査背景
z-indexの管理が煩雑になっており、frontend/src/constants/zIndex.tsが用意されているが、実際に使用しているのはごく一部のコンポーネントのみ。全てのコンポーネントにおいて適切な管理を行うための調査を実施。

## 現状分析

### 既存のzIndex.ts
- Z_INDEX（数値ベース）とTAILWIND_Z_INDEX（Tailwindクラス文字列ベース）の二重定義
- レイヤー構成: 基本(0-9)、ページ内要素(10-39)、オーバーレイ(40-49)、モーダル・ポップアップ(50-59)
- 適切な型定義が存在

### 使用状況調査結果
zIndex.ts定数を使用しているファイル: **わずか1ファイルのみ**
- `/components/ui/Overlay.tsx`（正しく実装されている良い例）

### 直接z-index指定している問題ファイル
**合計17ファイルで直接指定を確認**

#### z-50 重複使用（競合リスク高）
- `/components/header/Header.tsx:10`
- `/components/header/internals/MobileMenu.tsx:30`
- `/components/common/Toast.tsx:84`
- `/components/common/OfflineIndicator.tsx:14`
- `/components/common/FloatingYouTubeLink.tsx:7`
- `/components/ui/Modal.tsx:61`
- `/components/ui/tooltip.tsx:22`
- `/app/globals.css:159` (tooltip-base)

#### 任意のz-index値
- `/components/common/BottomSheet/BottomSheet.tsx:58` (z-[51])
- `/components/ui/MultiSelect.tsx:148` (z-52)

#### 基本レイヤー
- `/features/calendar/components/calender/internals/EventBand.tsx:29` (z-10)
- `/features/home/components/ProfileSection.tsx:28,50` (z-10)
- `/features/home/components/YouTubeLinkSection.tsx:32` (z-10)
- `/features/home/components/HeroSection.tsx:41,74` (z-0, z-10)

## 問題の根本原因

### 1. 導入されたが活用されていない中央管理システム
- zIndex.tsは適切に設計されているが、認知度・活用度が低い
- 新規コンポーネント開発時に直接指定が選ばれている

### 2. z-index値の重複と競合リスク
- z-50が8箇所で重複使用されている
- Header、Toast、Modal等の重要なUIコンポーネントで同じ値を使用
- 同時表示時の予期しない重なり順の発生可能性

### 3. 一貫性のない値の使用
- z-[51], z-52 等の任意の値の存在
- レイヤリング戦略の不統一

### 4. globals.cssとの不整合
- CSSファイル内でもz-50が定義され、管理が分散

## 技術的制約と可能性

### 利用可能な技術
- TypeScript: 型安全性の確保
- Tailwind CSS: ユーティリティクラスでの一元管理
- 既存のOverlay.tsxパターン: 参考実装として活用可能

### 制約事項
- Tailwind標準のz-index値の範囲内での設計が必要
- 既存コンポーネントの動作を維持しながらの段階的移行
- レスポンシブ対応との整合性維持

## 既存システムとの整合性

### 正常に動作している部分
- Overlay.tsxシステム: 適切な設計で型安全性も確保
- 基本的なモーダルシステム: ModalOverlay、BottomSheetOverlay
- プリセット機能: NavigationOverlay、ModalOverlay、BottomSheetOverlay

### 改善が必要な部分
- 直接指定コンポーネントの統合
- global.css内のz-index定義の統合
- 型定義の拡張（新しいレイヤー対応）

## 解決方針

### 1. zIndex.ts設計の見直し
- より明確で拡張可能な階層構造の再設計
- レイヤーごとの用途と範囲の明確化
- 競合回避のための値の再配分

### 2. 段階的移行戦略
- 高リスク（z-50重複）コンポーネントから優先的に対応
- 型安全性を保持した移行
- 動作検証を含めた段階的ロールアウト

### 3. 拡張性の確保
- 将来的な新機能追加に対応できる設計
- ESLintルール等による直接指定の制限検討

## 対象ファイル一覧

### 修正対象（優先度：高）
1. `/constants/zIndex.ts` - 設計見直し
2. `/components/header/Header.tsx`
3. `/components/header/internals/MobileMenu.tsx`
4. `/components/common/Toast.tsx`
5. `/components/common/OfflineIndicator.tsx`
6. `/components/common/FloatingYouTubeLink.tsx`
7. `/components/ui/Modal.tsx`
8. `/components/ui/tooltip.tsx`
9. `/app/globals.css`

### 修正対象（優先度：中）
10. `/components/common/BottomSheet/BottomSheet.tsx`
11. `/components/ui/MultiSelect.tsx`

### 修正対象（優先度：低）
12. `/features/calendar/components/calender/internals/EventBand.tsx`
13. `/features/home/components/ProfileSection.tsx`
14. `/features/home/components/YouTubeLinkSection.tsx`
15. `/features/home/components/HeroSection.tsx`

### 参考実装
- `/components/ui/Overlay.tsx` - 良い実装例として活用

## リスク分析

### 高リスク
- z-50重複による表示順序の競合
- Modal、Header、Toast等の重要UIでの問題発生可能性

### 中リスク
- 移行作業中の一時的な表示乱れ
- 既存動作への影響

### 低リスク
- パフォーマンスへの影響（軽微）
- 開発者体験の向上による長期的メリット

## 期待される効果

### 短期効果
- z-index競合の解消
- 表示順序の安定化
- 保守性の向上

### 長期効果
- 新機能開発時の階層管理の簡素化
- バグ発生率の低下
- 開発効率の向上

## 次フェーズ（PLAN）での推奨事項

1. **詳細実装設計**
   - 新しいz-index階層の詳細設計
   - 移行手順の具体化
   - テスト戦略の策定

2. **優先順位付けされた実装計画**
   - 高リスクコンポーネントから順次対応
   - 段階的ロールアウト計画

3. **品質保証計画**
   - 全モーダル・オーバーレイ・ドロップダウンの動作確認
   - レグレッションテストの実施

## まとめ
z-index管理の問題は設計レベルでは適切に準備されているが、実装レベルでの活用が不十分であることが判明。17ファイルでの直接指定を統一することで、競合リスクを解消し、保守性を大幅に向上させることが可能。特にz-50の重複使用は早急な対応が必要。