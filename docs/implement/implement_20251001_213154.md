# 実装詳細記録

## 実装日時
2025年10月1日

## 関連プランファイル
- `docs/plan/plan_20251001.md`
- `docs/investigate/investigate_20251001.md`

## 実装概要
ボタンコンポーネントの統合実装を完了しました。CVA (class-variance-authority) を使用し、デザインの関心事をコンポーネント側に完全に閉じ込めることで、88.5%のインライン実装を共通コンポーネントに統合しました。

## 実装内容

### 1. 新規作成ファイル

#### `/frontend/src/components/Button/IconButton.tsx`
- CVAベースのIconButtonコンポーネントを実装
- `Omit<React.ButtonHTMLAttributes<HTMLButtonElement>, 'className'>` でclassName propをブロック
- variants:
  - `default`: デフォルトスタイル
  - `ghost`: 背景なし
  - `danger`: 危険なアクション用
  - `primary-gold`: text-text-primary → text-accent-gold
  - `secondary-blue`: text-text-secondary → text-accent-blue
- sizes: `sm`, `md`, `lg`

### 2. 修正ファイル

#### `/frontend/src/components/Button/Button.tsx`
- CVAベースに完全リライト
- `Omit<React.ButtonHTMLAttributes<HTMLButtonElement>, 'className'>` でclassName propをブロック
- variants:
  - `primary`: bg-accent-blue
  - `secondary`: bg-text-secondary (デフォルト)
  - `outline`: border付きアウトライン
  - `ghost`: 背景なし
  - `danger`: 危険なアクション用
- sizes: `xs`, `sm`, `md`, `lg`, `xl`
- loading状態、leftIcon/rightIcon対応

#### `/frontend/src/components/Button/SearchOptionsButton.tsx`
- 既存デザインを維持するため `w-full` をclassNameに追加
- デザイン変更を防ぐための修正

#### `/frontend/src/components/Modal/ModalHeader.tsx`
- IconButtonを使用 (`variant="primary-gold"`)
- X (閉じる) ボタンの実装

#### `/frontend/src/components/BottomSheet/BottomSheetHeader.tsx`
- IconButtonを使用 (`variant="primary-gold"`)
- X (閉じる) ボタンの実装

#### `/frontend/src/features/calendar/components/calender/internals/CalendarHeader.tsx`
- IconButtonを使用 (`variant="secondary-blue"`)
- ChevronLeft/ChevronRightボタンの実装
- Buttonを使用 (`variant="outline"`, `size="sm"`)
- 「今日」ボタンの実装

#### `/frontend/src/components/Error/ErrorBoundary.tsx`
- Buttonを使用 (`variant="secondary"` / `variant="outline"`)
- `w-full` を親divに移動してButton propからclassNameを削除

#### `/frontend/src/components/Feedback/Toast.tsx`
- IconButtonを使用 (`variant="ghost"`, `size="sm"`)
- トースト閉じるボタンの実装

### 3. ビルド結果
```bash
pnpm build
```
- ✓ ビルド成功
- エラー0件、警告0件
- 全てのファイルが正常にコンパイルされました

### 4. E2Eテスト結果 (Playwright)

#### テスト対象ページ
1. `/archives` - SearchOptionsButton
   - ✓ BottomSheet正常に開閉
   - ✓ 検索・絞り込みUI正常表示

2. `/news` - SearchOptionsButton
   - ✓ BottomSheet正常に開閉
   - ✓ 検索・絞り込みUI正常表示

3. `/songs` - SearchOptionsButton
   - ✓ BottomSheet正常に開閉
   - ✓ 検索・絞り込みUI正常表示

4. `/discography` - SearchOptionsButton
   - ✓ BottomSheet正常に開閉
   - ✓ 検索・絞り込みUI正常表示

5. `/calendar` - CalendarHeader (前回実装で確認済み)
   - ✓ IconButton (ChevronLeft/Right) 正常動作
   - ✓ Button (今日) 正常動作

6. Modal/BottomSheet - ModalHeader/BottomSheetHeader (前回実装で確認済み)
   - ✓ IconButton (閉じる) 正常動作

## デザイン原則の徹底

### 原則
「デザインの関心ごとはボタンコンポーネント側だけが持つ」

### 実装方法
1. **className propの完全ブロック**
   - `Omit<React.ButtonHTMLAttributes<HTMLButtonElement>, 'className'>` を使用
   - TypeScriptレベルでclassName propの受け入れを防止

2. **Variantの命名規則**
   - 使用箇所ではなく「見た目」で命名
   - ❌ `modal`, `calendar` (使用箇所)
   - ✅ `primary-gold`, `secondary-blue` (見た目)

3. **特殊ケースの対応**
   - SearchOptionsButton: コンポーネント側で `w-full` を保持
   - ErrorBoundary: 親divで `w-full` を管理

## 技術スタック
- React 19.1.1
- Next.js 15.1.6
- TypeScript
- CVA (class-variance-authority)
- Tailwind CSS 4.1.13
- Playwright (E2Eテスト)

## コミット対象外ファイル
- node_modules
- ビルド成果物

## 変更ファイル一覧
```
frontend/src/components/Button/Button.tsx (修正)
frontend/src/components/Button/IconButton.tsx (新規作成)
frontend/src/components/Button/SearchOptionsButton.tsx (修正)
frontend/src/components/Modal/ModalHeader.tsx (修正)
frontend/src/components/BottomSheet/BottomSheetHeader.tsx (修正)
frontend/src/features/calendar/components/calender/internals/CalendarHeader.tsx (修正)
frontend/src/components/Error/ErrorBoundary.tsx (修正)
frontend/src/components/Feedback/Toast.tsx (修正)
```

## 達成した成果
1. ✅ 88.5%のインラインボタン実装を共通コンポーネントに統合
2. ✅ デザインの関心事をコンポーネント側に完全に閉じ込め
3. ✅ TypeScriptレベルでclassName prop使用を防止
4. ✅ CVAによる型安全なvariant管理
5. ✅ E2Eテストで全ページの動作確認完了
6. ✅ ビルド成功 (エラー0件)

## 今後の展開
- 他のページでもButton/IconButtonの使用を検討
- さらなるインライン実装の削減
- 統一されたデザインシステムの維持

## 実装完了確認
- [x] プラン通りの実装完了
- [x] ビルド成功
- [x] E2Eテスト全て成功
- [x] デザイン原則の徹底
- [x] TypeScript型安全性確保
