# 実装詳細: ページング設定リファクタリング

## 実装日時
2025-10-04 22:39:30

## 関連ドキュメント
- プラン: `docs/plan/plan_20251004_220637.md`
- 調査報告: `docs/investigate/investigate_20251004_214427.md`
- ブランチ: `feature/refactor-pagination-config`

## 実装概要
ページング設定を一元管理し、メンテナンス性と一貫性を向上させるリファクタリングを実施。

## 実装内容

### フェーズ1: バックエンド修正

#### 1-1. SongDto.kt修正（パラメータ名統一）
**ファイル:** `backend/src/main/kotlin/com/shirogane/holy/knights/adapter/controller/dto/SongDto.kt`

**修正内容:**
- `SongSearchParamsDto`: `val size: Int = 20` → `val pageSize: Int = 20`
- `StreamSongSearchParamsDto`: `val size: Int = 20` → `val pageSize: Int = 20`
- `toPageRequest()`メソッド内: `PageRequest(page, size)` → `PageRequest(page, pageSize)`

**結果:** ✅ 完了

#### 1-2. AlbumDto.kt修正（デフォルト値変更）
**ファイル:** `backend/src/main/kotlin/com/shirogane/holy/knights/adapter/controller/dto/AlbumDto.kt`

**修正内容:**
- `AlbumSearchParamsDto` (131行目): `val pageSize: Int = 20` → `val pageSize: Int = 12`

**結果:** ✅ 完了

#### 1-3. NewsDto.kt修正（デフォルト値変更）
**ファイル:** `backend/src/main/kotlin/com/shirogane/holy/knights/adapter/controller/dto/NewsDto.kt`

**修正内容:**
- `NewsSearchParamsDto` (83行目): `val pageSize: Int = 20` → `val pageSize: Int = 12`

**結果:** ✅ 完了

#### 1-4. バックエンドビルド確認
**コマンド:** `cd backend && ./gradlew build -x test`

**結果:** ✅ BUILD SUCCESSFUL in 35s

---

### フェーズ2: フロントエンド設定ファイル作成

#### 2-1. Songs設定ファイル作成
**ファイル:** `frontend/src/features/songs/config/pagination.ts`

**内容:**
```typescript
export const PAGINATION_CONFIG = {
  PAGE_SIZE: 20,
  INITIAL_PAGE: 1,
} as const;
```

**結果:** ✅ 完了

#### 2-2. News設定ファイル作成
**ファイル:** `frontend/src/features/news/config/pagination.ts`

**内容:**
```typescript
export const PAGINATION_CONFIG = {
  PAGE_SIZE: 12,
  INITIAL_PAGE: 1,
} as const;
```

**結果:** ✅ 完了

#### 2-3. Discography設定ファイル作成
**ファイル:** `frontend/src/features/discography/config/pagination.ts`

**内容:**
```typescript
export const PAGINATION_CONFIG = {
  PAGE_SIZE: 12,
  INITIAL_PAGE: 1,
} as const;
```

**結果:** ✅ 完了

#### 2-4. Archives設定ファイル作成
**ファイル:** `frontend/src/features/archives/config/pagination.ts`

**内容:**
```typescript
export const PAGINATION_CONFIG = {
  PAGE_SIZE: 20,
  INITIAL_PAGE: 1,
} as const;
```

**結果:** ✅ 完了

---

### フェーズ3: フロントエンドAPIクライアント修正

#### 3-1. Songs型定義修正
**ファイル:** `frontend/src/features/songs/types/types.ts`

**修正内容:**
- `StreamSongSearchParams`インターフェース: `size?: number;` → `pageSize?: number;`

**結果:** ✅ 完了

---

### フェーズ4: フロントエンドHook修正

#### 4-1. useStreamSongs.ts修正
**ファイル:** `frontend/src/features/songs/hooks/useStreamSongs.ts`

**修正内容:**
1. インポート追加: `import { PAGINATION_CONFIG } from '../config/pagination';`
2. デフォルト値変更: `pageSize = 12` → `pageSize = PAGINATION_CONFIG.PAGE_SIZE`
3. デフォルト値変更: `initialPage = 1` → `initialPage = PAGINATION_CONFIG.INITIAL_PAGE`

**結果:** ✅ 完了

#### 4-2. useConcertSongs.ts修正
**ファイル:** `frontend/src/features/songs/hooks/useConcertSongs.ts`

**修正内容:**
1. インポート追加: `import { PAGINATION_CONFIG } from '../config/pagination';`
2. デフォルト値変更: `pageSize = 12` → `pageSize = PAGINATION_CONFIG.PAGE_SIZE`
3. デフォルト値変更: `initialPage = 1` → `initialPage = PAGINATION_CONFIG.INITIAL_PAGE`

**結果:** ✅ 完了

#### 4-3. useNews.ts修正
**ファイル:** `frontend/src/features/news/hooks/useNews.ts`

**修正内容:**
1. インポート追加: `import { PAGINATION_CONFIG } from '../config/pagination';`
2. デフォルト値変更: `pageSize = 20` → `pageSize = PAGINATION_CONFIG.PAGE_SIZE`
3. デフォルト値変更: `initialPage = 1` → `initialPage = PAGINATION_CONFIG.INITIAL_PAGE`

**結果:** ✅ 完了

#### 4-4. useDiscography.ts修正
**ファイル:** `frontend/src/features/discography/hooks/useDiscography.ts`

**修正内容:**
1. インポート追加: `import { PAGINATION_CONFIG } from '../config/pagination';`
2. デフォルト値変更: `pageSize = 20` → `pageSize = PAGINATION_CONFIG.PAGE_SIZE`
3. デフォルト値変更: `initialPage = 1` → `initialPage = PAGINATION_CONFIG.INITIAL_PAGE`

**結果:** ✅ 完了

#### 4-5. useVideos.ts修正
**ファイル:** `frontend/src/features/archives/hooks/useVideos.ts`

**修正内容:**
1. インポート追加: `import { PAGINATION_CONFIG } from '../config/pagination';`
2. デフォルト値変更: `pageSize = 20` → `pageSize = PAGINATION_CONFIG.PAGE_SIZE`
3. デフォルト値変更: `initialPage = 1` → `initialPage = PAGINATION_CONFIG.INITIAL_PAGE`

**結果:** ✅ 完了

#### 4-6. useStreams.ts修正
**ファイル:** `frontend/src/features/archives/hooks/useStreams.ts`

**修正内容:**
1. インポート追加: `import { PAGINATION_CONFIG } from '../config/pagination';`
2. デフォルト値変更: `pageSize = 20` → `pageSize = PAGINATION_CONFIG.PAGE_SIZE`
3. デフォルト値変更: `initialPage = 1` → `initialPage = PAGINATION_CONFIG.INITIAL_PAGE`

**結果:** ✅ 完了

---

### フェーズ5: フロントエンドページコンポーネント修正

#### 5-1. app/songs/page.tsx修正
**ファイル:** `frontend/src/app/songs/page.tsx`

**修正内容:**
1. インポート追加: `import { PAGINATION_CONFIG } from '@/features/songs/config/pagination';`
2. Hook呼び出し修正:
   - `useStreamSongs({ pageSize: 20 })` → `useStreamSongs({ pageSize: PAGINATION_CONFIG.PAGE_SIZE })`
   - `useConcertSongs({ pageSize: 20 })` → `useConcertSongs({ pageSize: PAGINATION_CONFIG.PAGE_SIZE })`
3. Paginationコンポーネント修正:
   - `pageSize={12}` → `pageSize={PAGINATION_CONFIG.PAGE_SIZE}`

**結果:** ✅ 完了

#### 5-2. app/news/page.tsx修正
**ファイル:** `frontend/src/app/news/page.tsx`

**修正内容:**
1. インポート追加: `import { PAGINATION_CONFIG } from '@/features/news/config/pagination';`
2. Hook呼び出し修正: `useNews({ pageSize: 10 })` → `useNews({ pageSize: PAGINATION_CONFIG.PAGE_SIZE })`
3. Paginationコンポーネント修正: `pageSize={10}` → `pageSize={PAGINATION_CONFIG.PAGE_SIZE}`

**結果:** ✅ 完了

#### 5-3. app/discography/page.tsx修正
**ファイル:** `frontend/src/app/discography/page.tsx`

**修正内容:**
1. 既存の定数削除: `const PAGE_SIZE = 12;` を削除
2. インポート追加: `import { PAGINATION_CONFIG } from '@/features/discography/config/pagination';`
3. Hook呼び出し修正: `useDiscography({ pageSize: PAGE_SIZE })` → `useDiscography({ pageSize: PAGINATION_CONFIG.PAGE_SIZE })`
4. Paginationコンポーネント修正: `pageSize={PAGE_SIZE}` → `pageSize={PAGINATION_CONFIG.PAGE_SIZE}`

**結果:** ✅ 完了

#### 5-4. app/archives/page.tsx修正
**ファイル:** `frontend/src/app/archives/page.tsx`

**修正内容:**
1. インポート追加: `import { PAGINATION_CONFIG } from '@/features/archives/config/pagination';`
2. Hook呼び出し修正:
   - `useVideos({pageSize: 20})` → `useVideos({pageSize: PAGINATION_CONFIG.PAGE_SIZE})`
   - `useStreams({pageSize: 20})` → `useStreams({pageSize: PAGINATION_CONFIG.PAGE_SIZE})`
3. Paginationコンポーネント修正: `pageSize={20}` → `pageSize={PAGINATION_CONFIG.PAGE_SIZE}`

**結果:** ✅ 完了

---

### フェーズ6: ビルドエラー修正

#### 6-1. useStreamSongsQuery.ts修正
**ファイル:** `frontend/src/features/songs/hooks/useStreamSongsQuery.ts`

**修正内容:**
- APIパラメータ: `size: pageSize,` → `pageSize: pageSize,`

**結果:** ✅ 完了

#### 6-2. useConcertSongsQuery.ts修正
**ファイル:** `frontend/src/features/songs/hooks/useConcertSongsQuery.ts`

**修正内容:**
- APIパラメータ: `size: pageSize,` → `pageSize: pageSize,`

**結果:** ✅ 完了

---

## 最終的なページサイズ設定

| 機能 | ページサイズ | 設定ファイル |
|------|-------------|-------------|
| Songs | 20 | `frontend/src/features/songs/config/pagination.ts` |
| News | 12 | `frontend/src/features/news/config/pagination.ts` |
| Discography | 12 | `frontend/src/features/discography/config/pagination.ts` |
| Archives | 20 | `frontend/src/features/archives/config/pagination.ts` |

## 修正ファイル一覧

### 新規作成（4ファイル）
1. `frontend/src/features/songs/config/pagination.ts`
2. `frontend/src/features/news/config/pagination.ts`
3. `frontend/src/features/discography/config/pagination.ts`
4. `frontend/src/features/archives/config/pagination.ts`

### 修正（16ファイル）

**バックエンド（3ファイル）:**
1. `backend/src/main/kotlin/com/shirogane/holy/knights/adapter/controller/dto/SongDto.kt`
2. `backend/src/main/kotlin/com/shirogane/holy/knights/adapter/controller/dto/AlbumDto.kt`
3. `backend/src/main/kotlin/com/shirogane/holy/knights/adapter/controller/dto/NewsDto.kt`

**フロントエンド（13ファイル）:**
- 型定義（1ファイル）:
  4. `frontend/src/features/songs/types/types.ts`

- Hook（8ファイル）:
  5. `frontend/src/features/songs/hooks/useStreamSongs.ts`
  6. `frontend/src/features/songs/hooks/useConcertSongs.ts`
  7. `frontend/src/features/songs/hooks/useStreamSongsQuery.ts`
  8. `frontend/src/features/songs/hooks/useConcertSongsQuery.ts`
  9. `frontend/src/features/news/hooks/useNews.ts`
  10. `frontend/src/features/discography/hooks/useDiscography.ts`
  11. `frontend/src/features/archives/hooks/useVideos.ts`
  12. `frontend/src/features/archives/hooks/useStreams.ts`

- ページコンポーネント（4ファイル）:
  13. `frontend/src/app/songs/page.tsx`
  14. `frontend/src/app/news/page.tsx`
  15. `frontend/src/app/discography/page.tsx`
  16. `frontend/src/app/archives/page.tsx`

## 実装結果

### 成果
- ✅ バックエンドのパラメータ名を`pageSize`に統一
- ✅ バックエンドのデフォルト値をフロントエンドに合わせて調整
- ✅ 各機能ごとに設定ファイルを作成し、ページサイズを一元管理
- ✅ 全Hookで設定ファイルを参照するように変更
- ✅ 全ページコンポーネントで設定ファイルを参照するように変更
- ✅ バックエンドビルド成功確認

### 今後のメンテナンス
ページサイズを変更する場合は、各機能の設定ファイル（`config/pagination.ts`）のみを修正すればよい。

---

**作成日時:** 2025-10-04 22:39:30
**作成者:** Claude Code (implement phase)
**ブランチ:** feature/refactor-pagination-config
**関連プラン:** docs/plan/plan_20251004_220637.md