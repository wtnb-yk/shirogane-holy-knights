# Calendar コンポーネントリファクタリング実装計画

## 作成日時
2025-09-25 00:18:00

## 調査結果サマリー
- 調査ファイル: `docs/investigate/investigate_20250925_001700.md`
- CalendarHeaderとCalendarGridの統合によるコンポーネント設計の改善
- 既存コンポーネントを保持しながら新規統合コンポーネントを作成
- 後方互換性を維持する非破壊的変更

## 実装方針

### 1. アーキテクチャ設計
```
現在の構造:
CalendarPage
├── CalendarHeader (個別import)
└── CalendarGrid (個別import)

新しい構造:
CalendarPage
└── Calendar (統合コンポーネント)
    ├── CalendarHeader (内部使用)
    └── CalendarGrid (内部使用)
```

### 2. インターフェース設計
```typescript
// 統合されたCalendarPropsインターフェース
interface CalendarProps {
  // Header関連props
  currentView: CalendarView;
  currentDate: Date;
  onDateChange: (date: Date) => void;

  // Grid関連props
  events: Event[];
  loading?: boolean;
  error?: string | null;
  onEventClick: (event: Event) => void;
  onDateClick: (date: Date, events: Event[]) => void;
  onMobileDateClick?: (date: Date, events: Event[]) => void;
}
```

## 実装タスク詳細

### フェーズ1: コンポーネント作成（優先度: 高）

#### タスク1.1: Calendar.tsx作成
- **ファイル**: `frontend/src/features/calendar/components/Calendar.tsx`
- **実装内容**:
  ```typescript
  import { CalendarHeader } from './CalendarHeader';
  import { CalendarGrid } from './CalendarGrid';

  export function Calendar(props: CalendarProps) {
    return (
      <>
        <CalendarHeader
          currentView={props.currentView}
          currentDate={props.currentDate}
          onDateChange={props.onDateChange}
        />
        <CalendarGrid
          currentView={props.currentView}
          currentDate={props.currentDate}
          events={props.events}
          loading={props.loading}
          error={props.error}
          onEventClick={props.onEventClick}
          onDateClick={props.onDateClick}
          onMobileDateClick={props.onMobileDateClick}
        />
      </>
    );
  }
  ```

### フェーズ2: 既存コード更新（優先度: 高）

#### タスク2.1: calendar/page.tsx更新
- **対象行**: 154-179行目
- **変更内容**:
  1. import文の更新（5-6行目）
     - CalendarHeaderとCalendarGridのimportを削除
     - Calendarコンポーネントのimportを追加
  2. コンポーネント使用箇所の更新（154-179行目）
     - 個別のCalendarHeaderとCalendarGridを削除
     - 統合されたCalendarコンポーネントに置き換え

### フェーズ3: テスト実施（優先度: 高）

#### タスク3.1: E2Eテスト（Playwright）
1. **基本動作確認**
   - カレンダーページアクセス（http://localhost:3001/calendar）
   - カレンダー表示確認
   - 月表示の確認

2. **インタラクション確認**
   - 前月・翌月ナビゲーション
   - 「今日」ボタンのクリック
   - イベントクリックでモーダル表示
   - 日付クリックでイベント一覧表示

3. **レスポンシブ確認**
   - デスクトップビュー（1280x720）
   - モバイルビュー（375x667）
   - タブレットビュー（768x1024）

4. **フィルター機能確認**
   - サイドバーのフィルター適用
   - フィルター結果の表示確認

## ファイル変更計画

### 新規作成
| ファイルパス | 目的 | 行数見積もり |
|------------|------|------------|
| `frontend/src/features/calendar/components/Calendar.tsx` | 統合コンポーネント | 約40行 |

### 更新
| ファイルパス | 変更箇所 | 変更内容 |
|------------|---------|---------|
| `frontend/src/app/calendar/page.tsx` | 5-6行目 | import文の更新 |
| `frontend/src/app/calendar/page.tsx` | 154-179行目 | コンポーネント呼び出しの統合 |

### 削除
なし（既存コンポーネントは保持）

## リスク分析と対策

### リスク1: プロップドリリングの増加
- **影響度**: 低
- **対策**: 現時点では許容範囲内。将来的にContext APIやカスタムフックの導入を検討

### リスク2: 既存機能の動作不良
- **影響度**: 中
- **対策**: PlaywrightによるE2Eテストで全機能を確認

### リスク3: TypeScript型エラー
- **影響度**: 低
- **対策**: 型定義を正確に行い、コンパイルエラーを事前に確認

## 成功基準
1. ✅ Calendarコンポーネントが正常に作成される
2. ✅ calendar/page.tsxが正常に更新される
3. ✅ 全てのE2Eテストが成功する
4. ✅ TypeScriptコンパイルエラーがない
5. ✅ 既存の機能が全て正常に動作する

## 作業時間見積もり
- コンポーネント作成: 10分
- 既存コード更新: 5分
- E2Eテスト実施: 10分
- デバッグ・調整: 5分
- **合計**: 約30分

## 次フェーズへの移行条件
- 全ての成功基準を満たした場合 → IMPLEMENTフェーズへ
- テスト失敗や追加調査が必要な場合 → INVESTIGATEフェーズへ戻る

## 備考
- EventTypePresetsSectionの使用パターンも確認済み（CalendarSidebar, CalendarBottomSheetContent）
- 既存のデザインシステムとの整合性を維持
- 将来的な拡張性（週表示、日表示）も考慮した設計