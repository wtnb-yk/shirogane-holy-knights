# DayEventsModal ResponsiveModal対応 実装計画書

**計画日時**: 2025/09/27 19:01:07
**ブランチ**: feature/calendar-responsive-modal
**担当**: Claude Code

## 実装概要

### 目的
CalendarページのDayEventsModalコンポーネントをResponsiveModal対応に変更し、デスクトップではモーダル、モバイルではボトムシートとして表示できるようにする。

### 背景
- EventDetailModalで実装済みのResponsiveModalパターンが成功している
- ユーザー体験の一貫性を保つため、同様のパターンを適用
- モバイルユーザーのUX向上が期待できる

## 実装方針

### 基本方針
EventDetailModalと同一のパターンを採用：
1. ResponsiveModalコンポーネントを使用
2. useViewportフックによるデバイス判定
3. SSRハイドレーション対応（`!isLoaded || isDesktop`パターン）
4. 条件付きタイトル表示（デスクトップ時のみ）

### 技術的アプローチ
- 既存のModal/ModalContentをResponsiveModalに置き換え
- useViewportフックでビューポートサイズを判定
- SSRとクライアントサイドのハイドレーション不整合を防ぐ

## 詳細実装タスク

### Phase 1: 基本実装（優先度：高）

#### タスク1.1: DayEventsModal.tsxの修正
**ファイル**: `frontend/src/features/calendar/components/modals/DayEventsModal/DayEventsModal.tsx`

**変更内容**:
```typescript
// インポート変更
- import { Modal, ModalContent } from '@/components/ui/Modal';
+ import { ResponsiveModal } from '@/components/ui/ResponsiveModal';
+ import { useViewport } from '@/hooks/useViewport';

// コンポーネント内でuseViewportフック使用
const { isDesktop, isLoaded } = useViewport();

// SSRハイドレーション対応
const shouldUseDesktopLayout = !isLoaded || isDesktop;

// ResponsiveModal実装
<ResponsiveModal
  isOpen={isOpen}
  onClose={onClose}
  title={shouldUseDesktopLayout ? `${date.toLocaleDateString('ja-JP')}のイベント` : ""}
  className={shouldUseDesktopLayout ? "space-y-2 sm:space-y-3 max-h-[85vh] sm:max-h-[90vh] overflow-y-auto" : ""}
>
  {/* 既存の子コンポーネント */}
</ResponsiveModal>
```

**推定作業時間**: 10分

### Phase 2: 動作確認（優先度：高）

#### タスク2.1: ビルド確認
- TypeScriptコンパイルエラーの確認と解消
- Next.jsビルドプロセスの成功確認
- ESLint警告の確認

**推定作業時間**: 5分

#### タスク2.2: UI/UX確認
- デスクトップブラウザでのモーダル表示確認
- モバイルブラウザでのボトムシート表示確認
- レスポンシブブレイクポイント（1024px）での切り替え確認
- SSRハイドレーション動作の確認

**推定作業時間**: 5分

### Phase 3: テスト（優先度：高）

#### タスク3.1: E2Eテスト（Playwright MCP）
**テストシナリオ**:
1. カレンダーページへアクセス（`http://localhost:3001/calendar`）
2. イベントがある日付をクリック
3. DayEventsModalの表示確認
   - デスクトップ: モーダルとして表示
   - モバイル: ボトムシートとして表示
4. イベント項目をクリック
5. EventDetailModalへの遷移確認
6. 戻るボタンでDayEventsModalに戻る
7. モーダル/ボトムシートの閉じる操作

**推定作業時間**: 10分

## ファイル変更計画

### 修正対象ファイル
| ファイル | 変更内容 | 影響度 |
|---------|---------|--------|
| `frontend/src/features/calendar/components/modals/DayEventsModal/DayEventsModal.tsx` | ResponsiveModal対応 | 高 |

### 新規作成ファイル
なし

### 削除対象ファイル
なし

## テスト戦略

### 単体テスト
- 既存のテストスイートで互換性確認
- プロパティインターフェースの変更なしを確認

### 統合テスト
- CalendarページとDayEventsModalの連携確認
- DayEventsModalとEventDetailModalの連携確認

### E2Eテスト
- Playwright MCPを使用した自動テスト
- デスクトップとモバイルの両方で実施
- スクリーンショット比較による視覚的確認

## リスク分析と対策

### リスク項目

#### 1. SSRハイドレーション不整合
**リスクレベル**: 中
**影響**: コンソールエラー、初回レンダリングの不具合
**対策**:
- EventDetailModalと同じパターンを厳密に適用
- `shouldUseDesktopLayout`ロジックの正確な実装

#### 2. 既存機能の破損
**リスクレベル**: 低
**影響**: EventDetailModalへの遷移機能の不具合
**対策**:
- 子コンポーネントとプロパティの変更を最小限に
- 慎重なテスト実施

#### 3. レスポンシブ切り替え不具合
**リスクレベル**: 低
**影響**: ウィンドウリサイズ時の表示不具合
**対策**:
- useViewportフックの動作確認
- ブレイクポイント付近でのテスト

### 影響範囲分析
- **直接影響**: DayEventsModal.tsxのみ
- **間接影響**: なし（親コンポーネントの変更不要）
- **API影響**: なし
- **データ影響**: なし

## 実装スケジュール

| フェーズ | タスク | 推定時間 | 実績時間 |
|---------|--------|----------|----------|
| Phase 1 | 基本実装 | 10分 | - |
| Phase 2 | 動作確認 | 10分 | - |
| Phase 3 | テスト | 10分 | - |
| **合計** | - | **30分** | - |

## 成功基準

### 必須達成項目
1. ✅ TypeScriptビルドエラーなし
2. ✅ デスクトップでモーダル表示が正常
3. ✅ モバイルでボトムシート表示が正常
4. ✅ EventDetailModalとの連携が正常動作
5. ✅ SSRハイドレーションエラーなし

### 品質基準
- コードレビュー基準を満たす
- パフォーマンス劣化なし
- アクセシビリティ基準を維持

## 実装後の確認事項

### コード品質
- [ ] ESLint警告なし
- [ ] TypeScript型エラーなし
- [ ] 不要なconsole.logなし

### 機能確認
- [ ] デスクトップ表示
- [ ] モバイル表示
- [ ] レスポンシブ切り替え
- [ ] モーダル間遷移
- [ ] 閉じる操作

### ドキュメント
- [ ] 実装結果の記録
- [ ] 問題点と解決策の記録

## 参考資料

### 関連ファイル
- `frontend/src/features/calendar/components/modals/EventDetailModal/EventDetailModal.tsx`
- `frontend/src/components/ui/ResponsiveModal.tsx`
- `frontend/src/hooks/useViewport.ts`

### 関連ドキュメント
- `docs/investigate/investigate_20250927_185545.md`: 調査報告書
- `docs/implement/implement_20250926_143021.md`: EventDetailModal実装詳細

## 次フェーズ
**IMPLEMENT**: 本計画に基づいた実装作業の開始

---

**計画ステータス**: 策定完了
**承認待ち**: 実装開始の承認