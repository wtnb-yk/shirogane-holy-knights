# Modalコンポーネント スクロール修正実装プラン

## 策定日時
2025年9月27日 22:38:30

## 実装対象
Modalコンポー�ネントで縦幅が長いコンテンツの場合にヘッダーが固定されず、モーダル全体がスクロールしてしまう問題の解決

## 調査結果に基づく実装方針

### 根本原因
- Modal.tsx 63-75行目でモーダル全体に`overflow-y-auto`が適用されている
- ヘッダーも含めた全体がスクロール対象となっている

### 解決方針
BottomSheet.tsxで実証済みのFlexboxパターンをModal.tsxに適用:
1. モーダル全体を`flex flex-col overflow-hidden`に変更
2. ヘッダー部分は`flex-shrink-0`で固定
3. コンテンツ部分を`flex-1 overflow-y-auto min-h-0`でスクロール有効化

## 詳細実装タスク（優先度順）

### フェーズ1: コア修正（優先度：最高）
1. **Modal.tsx CSS構造修正** - 30分
   - 対象ファイル: `/frontend/src/components/ui/Modal.tsx`
   - 対象行: 63-75行目
   - 変更内容:
     ```tsx
     // 修正前
     <div className="max-h-[85vh] sm:max-h-[90vh] overflow-y-auto">
       <ModalHeader />
       <div className="px-4 pb-4 sm:px-6 sm:pb-6">{children}</div>
     </div>

     // 修正後
     <div className="max-h-[85vh] sm:max-h-[90vh] flex flex-col overflow-hidden">
       <div className="flex-shrink-0">
         <ModalHeader />
       </div>
       <div className="flex-1 overflow-y-auto min-h-0">
         <div className="px-4 pb-4 sm:px-6 sm:pb-6">{children}</div>
       </div>
     </div>
     ```

2. **基本動作確認** - 30分
   - ResponsiveModal経由モーダルの動作確認
   - スクロール動作とアニメーション確認

### フェーズ2: 包括的テスト（優先度：高）
3. **全Modal使用箇所確認** - 45分
   - 直接Modal使用コンポーネント:
     - `/features/discography/components/DiscographyDetailModal.tsx`
     - `/components/common/SearchOptionsModal/SearchOptionsModal.tsx`
   - ResponsiveModal経由コンポーネント:
     - `/features/songs/components/modals/SongDetailModal.tsx`
     - `/features/calendar/components/modals/EventDetailModal.tsx`
     - `/features/calendar/components/modals/DayEventsModal.tsx`

4. **E2Eテスト実行** - 30分
   - Playwright MCPツールによる実ブラウザ確認
   - 各デバイスサイズでの動作確認

### フェーズ3: 品質保証（優先度：中）
5. **エッジケース確認** - 30分
   - 極端に長い/短いコンテンツのテスト
   - 動的コンテンツ変更時の動作確認

## ファイル変更計画

### 修正対象ファイル
- **Modal.tsx** (1ファイルのみ修正)
  - 種類: 修正
  - 影響範囲: CSS構造のみ
  - 破壊的変更: なし

### 自動恩恵ファイル
- **ResponsiveModal.tsx** - 変更不要（Modal.tsxの恩恵を自動享受）
- ResponsiveModal使用コンポーネント群 - 変更不要（自動改善）

### 個別確認必要ファイル
- 直接Modal使用コンポーネント群 - 変更不要（動作確認のみ）

## テスト戦略

### 単体テスト
- Modal.tsx基本動作確認
- ヘッダー固定・コンテンツスクロール確認

### 統合テスト
- ResponsiveModal連携確認
- viewport切り替え動作確認

### E2Eテスト
- 実ブラウザでの包括確認
- 長いコンテンツでのスクロール動作確認
- アニメーション正常動作確認

### 回帰テスト
- 既存機能の保証
- 全Modal使用箇所での動作確認

## リスク分析と対策

### 主要リスク
1. **CSS Flexboxレイアウト変更によるレイアウト崩れ**
   - 確率: 中
   - 影響: モーダル表示崩れ
   - 対策: BottomSheetで実証済みパターン使用、段階的テスト実行

2. **既存アニメーションとの競合**
   - 確率: 低
   - 影響: アニメーション不正常
   - 対策: `animate-modal-slide-scale`は維持、CSSクラス変更のみ

3. **レスポンシブ動作への影響**
   - 確率: 低
   - 影響: デバイス切り替え時の表示不正常
   - 対策: ResponsiveModal仕組み維持、E2E確認

### 軽減策
- 即座ロールバック可能な小さな変更
- 段階的テストによる早期発見
- 実証済みパターンの採用

## 期待される効果

### 直接効果
- ヘッダー固定でコンテンツ部分のみスクロール
- ユーザビリティの向上

### 間接効果
- モバイル・デスクトップ間の一貫性確保
- 既存機能の互換性維持
- BottomSheetとの統一性確保

## 成功指標
- ✅ ヘッダー固定でコンテンツ部分のみスクロール
- ✅ 既存アニメーション完全維持
- ✅ 全Modal使用箇所での正常動作
- ✅ モバイル・デスクトップ一貫性確保

## 総実装時間
約2.5時間（テスト含む）

## 次フェーズ
IMPLEMENT - 実装フェーズへの移行