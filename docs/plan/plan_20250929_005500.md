# 実装計画: コンポーネントディレクトリ構造再編成

## 計画日時
2025-09-29 00:55:00

## プロジェクト概要
frontend/src/components内のui/とcommon/ディレクトリを廃止し、機能別に21のカテゴリに再編成する大規模リファクタリング。

## 前提条件
- 調査フェーズ完了（docs/investigate/investigate_20250929_005055.md）
- feature/component-directory-restructureブランチで作業中
- 84ファイルで149箇所のimportが影響を受ける

## 実装方針

### 基本戦略
1. **段階的実装**: 4フェーズに分けてリスクを最小化
2. **既存構造保持**: header/, footer/, BottomSheet/, seo/, analytics/は現状維持
3. **TypeScript完全対応**: 各段階で型チェック・ビルドチェック実施
4. **Playwright検証**: E2Eテストで実際の動作確認を必須とする

### 新しいディレクトリ構造（21カテゴリ）

#### 新規作成ディレクトリ
1. **Button/** - ボタン系（Button, FilterToggleButton, SearchOptionsButton, ModalButton）
2. **Input/** - 入力系（SearchInput, DateInput, DateRangeInput, SegmentedControl）
3. **Select/** - 選択系（Select, MultiSelect, MultiSelectSection）
4. **Card/** - カード表示（card, InteractiveCard, StaggeredItem）
5. **Modal/** - モーダル・ダイアログ（Modal, ResponsiveModal, ModalHeader, SearchOptionsModal）
6. **Overlay/** - オーバーレイ（Overlay, OverlayIcon）
7. **List/** - リスト表示（SelectableList, SelectableListHeader, SelectableListItem）
8. **Layout/** - レイアウト（PageLayout, PageTitle, BaseGrid）
9. **Navigation/** - ナビゲーション（Pagination, LinkText）
10. **Badge/** - バッジ表示（badge）
11. **Image/** - 画像表示（OptimizedImage）
12. **Loading/** - ローディング（LoadingState, BaseSkeleton, skeleton）
13. **Error/** - エラー処理（ErrorDisplay, ErrorBoundary）
14. **Feedback/** - フィードバック（Toast, tooltip, OfflineIndicator）
15. **Stats/** - 統計表示（StatsSummary, SearchResultsSummary）
16. **Section/** - セクション（各種PresetsSection, BottomSheetSectionHeader）
17. **Misc/** - その他（DynamicComponents, FloatingYouTubeLink）

#### 保持ディレクトリ
- **BottomSheet/** - 既存構造維持
- **Sidebar/** - 内部コンポーネント一部移動
- **header/** - 既存構造維持
- **footer/** - 既存構造維持
- **seo/** - 既存構造維持
- **analytics/** - 既存構造維持

## 詳細実装計画

### フェーズ1: ディレクトリ構造作成
**所要時間**: 15分
**優先度**: 高

#### タスク
1. 17の新規ディレクトリを作成
2. 各ディレクトリにindex.ts配置（将来的なバレルエクスポート用）

#### 成功条件
- 全ディレクトリが正常に作成される
- ディレクトリ構造がfeature/component-directory-restructureブランチに反映される

### フェーズ2: コンポーネント移動
**所要時間**: 45分
**優先度**: 高

#### 2.1 ui/ディレクトリからの移動（23ファイル）
- Button.tsx → Button/
- SearchInput.tsx → Input/
- Select.tsx, MultiSelect.tsx → Select/
- card.tsx, InteractiveCard.tsx, StaggeredItem.tsx → Card/
- Modal.tsx, ResponsiveModal.tsx, ModalButton.tsx, ModalHeader.tsx → Modal/
- Overlay.tsx, OverlayIcon.tsx → Overlay/
- Pagination.tsx, LinkText.tsx → Navigation/
- badge.tsx → Badge/
- OptimizedImage.tsx → Image/
- skeleton.tsx → Loading/
- StatsSummary.tsx → Stats/
- SearchOptionsButton.tsx → Button/
- DateInput.tsx, DateRangeSection.tsx → Input/
- tooltip.tsx → Feedback/

#### 2.2 common/ディレクトリからの移動（18ファイル + 3サブディレクトリ）
- PageLayout.tsx, PageTitle.tsx, BaseGrid.tsx → Layout/
- SelectableList.tsx, SelectableListHeader.tsx, SelectableListItem.tsx → List/
- MultiSelectSection.tsx → Select/
- ErrorDisplay.tsx, ErrorBoundary.tsx → Error/
- LoadingState.tsx, BaseSkeleton.tsx → Loading/
- Toast.tsx, OfflineIndicator.tsx → Feedback/
- SearchResultsSummary.tsx → Stats/
- YearPresetsSection.tsx, EventTypePresetsSection.tsx, DatePresetsSection.tsx, DateRangeSection.tsx, BottomSheetSectionHeader.tsx → Section/
- DynamicComponents.tsx, FloatingYouTubeLink.tsx → Misc/

#### 2.3 サブディレクトリの再配置
- SearchOptionsModal/SearchOptionsModal.tsx → Modal/
- Sidebar/FilterToggleButton.tsx → Button/
- Sidebar/DateRangeInput.tsx, Sidebar/SegmentedControl.tsx → Input/
- Sidebar/internals/ → Sidebar/（保持）

#### 成功条件
- 全ファイルが正しいディレクトリに移動される
- 元のui/とcommon/ディレクトリが空になる
- ファイル内容に変更がない

### フェーズ3: Import文更新
**所要時間**: 60分
**優先度**: 中

#### 3.1 components/index.tsの全面改修
- 既存の60行のexport文を新しいパス構造に更新
- カテゴリ別にグループ化してコメント追加
- export構造の整合性確認

#### 3.2 全プロジェクトのimport文更新（約150箇所）
- 84ファイルで149箇所のimport文を新パスに更新
- 相対パスから絶対パス（@/components）への統一
- TypeScriptコンパイラーによる自動検証

#### 成功条件
- 全てのimport文が新しいパス構造に対応
- コンパイルエラーが発生しない
- export漏れがない

### フェーズ4: 検証・テスト
**所要時間**: 30分
**優先度**: 高

#### 4.1 TypeScript関連検証
- `npm run typecheck`でコンパイルエラーチェック
- `npm run lint`でコードスタイル確認
- ビルド処理の正常性確認

#### 4.2 Playwright E2Eテスト
- 主要ページの表示確認
- フォーム動作の確認
- ナビゲーション機能の確認
- 検索機能の確認

#### 4.3 視覚的検証
- localhost:3001での画面表示確認
- UI/UXに影響がないことの確認
- レスポンシブデザインの確認

#### 成功条件
- 全てのテストがパス
- 視覚的に問題がない
- パフォーマンスに影響がない

## リスク分析と対策

### 主要リスク

#### 1. Import文の大量変更によるエラー
**リスク**: 約150箇所のimport文変更でヒューマンエラー発生
**影響度**: 高
**対策**:
- TypeScriptコンパイラーによる自動検証活用
- 段階的な変更とテスト実行
- 自動化スクリプトの検討

#### 2. 相対パスの誤り
**リスク**: ファイル移動時の相対パス計算ミス
**影響度**: 中
**対策**:
- 絶対パス（@/components）の積極活用
- 各段階でのビルドチェック実行

#### 3. Export漏れ
**リスク**: components/index.tsでのexport忘れ
**影響度**: 中
**対策**:
- 既存のexport構造を参考に段階的更新
- TypeScript型チェックによる検証

#### 4. 実行時エラー
**リスク**: コンパイルは通るが実行時に問題発生
**影響度**: 高
**対策**:
- Playwrightでの実際の動作確認を各段階で実施
- 主要機能の動作テスト強化

#### 5. 既存動作への影響
**リスク**: 意図せず他機能に影響
**影響度**: 高
**対策**:
- E2Eテストでユーザー動作確認
- 段階的Git commitでロールバック準備

### 緊急時対応手順

#### ロールバック手順
1. 問題のあるコミットを特定
2. `git revert <commit-hash>`でロールバック
3. 影響範囲を調査
4. 修正方針を再検討

#### 問題発生時のエスカレーション
1. TypeScriptエラー → コンパイラーメッセージを確認
2. 実行時エラー → ブラウザDevToolsで詳細確認
3. 画面表示問題 → Playwrightスクリーンショット取得

## 品質保証

### チェックリスト

#### フェーズ1完了時
- [ ] 17の新規ディレクトリが作成されている
- [ ] 各ディレクトリにindex.tsが配置されている
- [ ] ディレクトリ構造がGitに反映されている

#### フェーズ2完了時
- [ ] ui/ディレクトリが空になっている
- [ ] common/ディレクトリが空になっている（サブディレクトリを除く）
- [ ] 全ファイルが適切なカテゴリに移動されている
- [ ] ファイル内容に変更がない

#### フェーズ3完了時
- [ ] components/index.tsが新構造に対応している
- [ ] 全import文が新パスに更新されている
- [ ] TypeScriptコンパイルエラーがない

#### フェーズ4完了時
- [ ] `npm run typecheck`がパスしている
- [ ] `npm run lint`がパスしている
- [ ] Playwrightテストがパスしている
- [ ] localhost:3001で正常に動作している

### パフォーマンス指標
- ビルド時間: 現状維持
- バンドルサイズ: 現状維持
- 初期読み込み時間: 現状維持
- TypeScript型チェック時間: 現状維持

## 今後の改善計画

### 短期的改善（実装完了後）
1. 各ディレクトリのindex.tsでバレルエクスポート実装
2. コンポーネント命名規則のドキュメント化
3. 新しい構造でのStorybook更新

### 中期的改善（1-2ヶ月後）
1. コンポーネントのStorybookカタログ作成
2. 自動import整理スクリプトの導入
3. コンポーネント依存関係の可視化

### 長期的改善（3-6ヶ月後）
1. Design Systemとしての体系化
2. コンポーネント間のAPI統一化
3. 自動テスト生成の仕組み導入

## 実装開始時の前提確認

### 環境確認
- [ ] feature/component-directory-restructureブランチで作業
- [ ] Node.js環境正常
- [ ] npm依存関係インストール済み
- [ ] TypeScript設定確認済み

### 作業方針確認
- [ ] 各フェーズ完了後にコミット
- [ ] 問題発生時は即座に報告・対策
- [ ] PlaywrightによるE2E確認を必須とする
- [ ] 他の開発作業への影響を最小化

## 結論

本実装計画により、以下の目標を達成する：

### 主要な成果物
1. **機能別ディレクトリ構造**: 21カテゴリによる明確な分類
2. **保守性向上**: 関連コンポーネントのグループ化
3. **開発効率向上**: 新規コンポーネント配置場所の明確化
4. **import文の意味的整理**: 機能別の論理的なimport構造

### 期待効果
- コンポーネントの種類が一目で判別可能
- 新しい開発者のオンボーディング時間短縮
- コードレビュー効率の向上
- 将来的なDesign System構築の基盤整備

この計画に基づき、段階的かつ安全に実装を進行する。