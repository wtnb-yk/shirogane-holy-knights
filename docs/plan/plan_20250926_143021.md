# EventDetailModal ResponsiveModal対応 実装プラン

**策定日時**: 2025/09/26 14:30:21
**ブランチ**: feature/calendar-responsive-modal
**担当**: Claude Code

## プラン概要

### 目的
CalendarのEventDetailModalをResponsiveModalに変更し、モバイルデバイスではボトムシート、デスクトップではモーダルとして表示することでUXを向上させる。

### 実装方針
既存のSongDetailModalのパターンを参考に、ResponsiveModalコンポーネントを使用した実装に変更する。既存機能の互換性を完全に維持しながら、レスポンシブ対応を追加する。

## 詳細実装タスク

### Phase 1: 基本実装（優先度：最高）

#### タスク1: EventDetailModal.tsxの修正
- **ファイル**: `frontend/src/features/calendar/components/modals/EventDetailModal/EventDetailModal.tsx`
- **作業内容**:
  - `Modal + ModalContent`から`ResponsiveModal`への置き換え
  - `useViewport`フックの導入
  - `shouldUseDesktopLayout`ロジックの実装
  - SongDetailModalパターンの適用
- **所要時間**: 30分
- **依存関係**: なし

#### タスク2: プロパティ互換性の確保
- **対象機能**:
  - `fromDayModal`機能の動作維持
  - `onBackToDayModal`機能の動作維持
  - 全プロパティの完全互換性
- **検証項目**:
  - DayEventsModalからの遷移
  - 戻るボタンの表示・動作
  - イベント詳細の表示内容
- **所要時間**: 15分

### Phase 2: テスト・検証（優先度：高）

#### タスク3: 動作確認
- **デスクトップ環境（≥1024px）**:
  - モーダルとしての表示確認
  - fromDayModal機能の動作確認
  - SSRハイドレーション対応確認
- **モバイル環境（<1024px）**:
  - ボトムシートとしての表示確認
  - fromDayModal機能の動作確認
  - タッチ操作の確認
- **所要時間**: 20分

#### タスク4: E2Eテスト
- **テストシナリオ**:
  1. カレンダーページでイベント直接クリック
  2. DayEventsModalからEventDetailModalへの遷移
  3. EventDetailModalからDayEventsModalへの戻り
  4. 各画面サイズでの表示確認
- **所要時間**: 15分

### Phase 3: 最適化検討（優先度：中）

#### タスク5: モバイル専用レイアウトの検討
- **対象**: 必要に応じてBottomSheet向けの最適化
- **判断基準**: 基本実装後のUX評価結果
- **所要時間**: 30分（実施の場合）

## ファイル変更計画

### 修正対象ファイル
1. **EventDetailModal.tsx** (修正)
   - `frontend/src/features/calendar/components/modals/EventDetailModal/EventDetailModal.tsx`
   - ResponsiveModalへの置き換え
   - useViewportフック導入

### 変更なしファイル
- EventDetailHeader.tsx
- EventTitle.tsx
- EventImage.tsx
- EventTimeInfo.tsx
- EventDescription.tsx
- index.tsx

### 新規作成ファイル
なし（既存コンポーネントを活用）

## テスト戦略

### 単体テスト
- **対象**: EventDetailModalコンポーネント
- **重点項目**: プロパティの正常な受け渡し、条件分岐ロジック
- **ツール**: 既存のテスト環境を活用

### 統合テスト
- **対象**: Calendar機能全体
- **重点項目**: Modal遷移、画面サイズ対応
- **確認項目**: イベント選択→詳細表示→閉じる の一連のフロー

### E2Eテスト
- **ツール**: PlaywrightのMCPツール
- **実施内容**:
  - デスクトップ環境での動作確認
  - モバイル環境での動作確認（ブラウザリサイズで確認）
  - fromDayModal機能の動作確認

## リスク分析と対策

### 低リスク項目
- **ResponsiveModalの安定性**: 既にSongDetailModalで実績あり
- **内部コンポーネントの再利用**: 変更不要で安全
- **プロパティ互換性**: 現在の実装で維持可能

### 注意すべき項目とその対策

#### リスク1: SSRハイドレーション問題
- **対策**: SongDetailModalと同じパターンを使用
- **実装**: `shouldUseDesktopLayout = !isLoaded || isDesktop`
- **検証**: 初期表示時の動作確認

#### リスク2: fromDayModal機能の互換性
- **対策**: 既存ロジックの完全保持
- **実装**: 条件分岐での適切な処理
- **検証**: DayEventsModalとの遷移テスト

#### リスク3: モバイルでの操作性
- **対策**: BottomSheetのデフォルト動作を活用
- **実装**: ResponsiveModalの標準機能を使用
- **検証**: タッチ操作の動作確認

## 実装の成功基準

### 必須項目（Phase 1完了時点）
- [ ] デスクトップでモーダル表示される
- [ ] モバイルでボトムシート表示される
- [ ] fromDayModal機能が正常動作する
- [ ] 全プロパティが正常に機能する
- [ ] SSRエラーが発生しない

### 追加項目（Phase 2完了時点）
- [ ] E2Eテストが全てパスする
- [ ] 既存のカレンダー機能に影響がない
- [ ] パフォーマンスが劣化しない

## タイムライン

### Phase 1: 基本実装
- **開始**: 即時
- **完了予定**: 45分後
- **成果物**: ResponsiveModal対応完了

### Phase 2: テスト・検証
- **開始**: Phase 1完了後
- **完了予定**: Phase 1完了から35分後
- **成果物**: 動作確認完了、E2Eテスト完了

### Phase 3: 最適化検討
- **開始**: Phase 2完了後（任意）
- **完了予定**: 30分（実施の場合）
- **成果物**: モバイル最適化（必要に応じて）

## 実装後の確認事項

### 機能確認
1. イベント詳細モーダルの表示（デスクトップ・モバイル）
2. DayEventsModalからの遷移機能
3. 戻るボタンの動作
4. モーダル/ボトムシートの閉じる動作

### 技術確認
1. SSRハイドレーションエラーの有無
2. コンソールエラーの有無
3. TypeScriptエラーの有無
4. ESLint/Prettier準拠

## 参考実装

- **SongDetailModal**: `frontend/src/features/songs/components/modals/SongDetailModal.tsx`
- **ResponsiveModal**: `frontend/src/components/ui/ResponsiveModal.tsx`
- **useViewport**: `frontend/src/hooks/useViewport.ts`

## 関連ドキュメント

- 調査報告書: `docs/investigate/investigate_20250926_143021.md`
- 実装ブランチ: `feature/calendar-responsive-modal`

---

**実装開始準備完了**: ✅
**次フェーズ**: IMPLEMENT Phase 1からの開始を推奨