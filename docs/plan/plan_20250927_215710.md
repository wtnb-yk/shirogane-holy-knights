# EventDetailHeader削除と戻る機能統合の実装計画

## 計画策定日時
2025年09月27日 21:57:10

## 調査結果要約
`docs/investigate/investigate_20250927_215303.md`の調査結果に基づき、EventDetailHeaderを削除してResponsiveModalのヘッダーに戻る機能を統合する実装計画を策定。

## 実装方針

### 基本アプローチ
1. ResponsiveModalに`backButton`プロパティを追加（任意プロパティ）
2. ModalHeader/BottomSheetHeaderに戻るボタンを条件付きで表示
3. EventDetailHeaderコンポーネントを削除
4. 既存機能への影響を最小限に抑制

### 技術的判断根拠
- 後方互換性を保持しながら機能統合が可能
- 重複ヘッダー問題を根本的に解決
- 既存のDayEventsModal、SongDetailModalには影響なし

## 詳細実装タスク（優先度順）

### 優先度: 高
1. **ResponsiveModal.tsx拡張**
   - `backButton?: { show: boolean; onClick: () => void; }`プロパティ追加
   - ModalHeader/BottomSheetHeaderに戻るボタン情報を渡す
   - 型定義の更新

2. **ModalHeader.tsx修正**
   - 戻るボタン（ChevronLeft）を条件付きで左側に表示
   - レイアウト調整：戻るボタン + タイトル + 閉じるボタン
   - アクセシビリティ対応（aria-label等）

3. **BottomSheetHeader.tsx修正**
   - ModalHeaderと同様の戻るボタン機能追加
   - モバイル最適化されたレイアウト調整
   - タッチ操作に適したボタンサイズ確保

### 優先度: 中
4. **EventDetailModal.tsx修正**
   - EventDetailHeaderコンポーネントの削除
   - ResponsiveModalの新しいbackButtonプロパティ使用
   - fromDayModal/onBackToDayModal props統合

### 優先度: 低
5. **EventDetailHeader.tsx削除**
   - ファイル削除
   - 関連するimport文の削除

## ファイル変更計画

### 修正対象ファイル
1. `frontend/src/components/ui/ResponsiveModal.tsx`
   - backButtonプロパティ追加
   - 型定義更新
   - ヘッダーコンポーネントへのprops渡し

2. `frontend/src/components/ui/ModalHeader.tsx`
   - 戻るボタンコンポーネント追加
   - レイアウト調整
   - アクセシビリティ対応

3. `frontend/src/components/common/BottomSheet/BottomSheetHeader.tsx`
   - 戻るボタンコンポーネント追加
   - モバイル最適化レイアウト

4. `frontend/src/features/calendar/components/modals/EventDetailModal.tsx`
   - EventDetailHeaderの削除
   - backButtonプロパティの使用

### 削除対象ファイル
1. `frontend/src/features/calendar/components/modals/internals/EventDetailHeader.tsx`

## テスト戦略

### 単体テスト
- ResponsiveModalのbackButtonプロパティ動作確認
- ModalHeader/BottomSheetHeaderの戻るボタン表示条件テスト

### 統合テスト
- EventDetailModalでの戻る機能統合テスト
- 既存Modal（DayEventsModal、SongDetailModal）への影響確認

### E2Eテスト（重要）
1. **デスクトップフロー**
   - DayEventsModal → EventDetailModal遷移
   - 戻るボタンでDayEventsModalに戻る
   - 直接EventDetailModal表示時は戻るボタン非表示

2. **モバイルフロー**
   - DayEventsBottomSheet → EventDetailModal遷移
   - 戻るボタンでDayEventsBottomSheetに戻る
   - タッチ操作での戻るボタン動作確認

3. **カレンダーページ全体フロー**
   - イベント直接クリック → EventDetailModal表示
   - 日付クリック → DayEventsModal → EventDetailModal遷移
   - モバイルでの同様フロー確認

## リスク分析と対策

### 低リスク項目
- 新機能は任意プロパティのため既存機能への影響は最小限
- 現在のブランチで安全に実装可能

### 中リスク項目と対策
1. **レイアウト崩れリスク**
   - 対策: 戻るボタン追加時のCSS調整を慎重に実施
   - デスクトップ/モバイル両方での表示確認

2. **アクセシビリティ課題**
   - 対策: ARIA属性、キーボードナビゲーション対応
   - スクリーンリーダーでの動作確認

3. **ユーザビリティ低下**
   - 対策: 戻るボタンの視認性確保
   - 一貫したデザインパターン採用

### 高リスク項目
なし（調査結果により技術的実現可能性を確認済み）

## 実装手順

### Phase 1: コア機能実装
1. ResponsiveModalの拡張
2. ModalHeader/BottomSheetHeaderの修正
3. 基本的な戻るボタン機能実装

### Phase 2: 統合とクリーンアップ
1. EventDetailModalの修正
2. EventDetailHeaderの削除
3. 型エラー修正

### Phase 3: テストと最適化
1. E2Eテスト実行
2. デザイン調整
3. アクセシビリティ確認

## 成功基準

### 機能要件
- DayEventsModal → EventDetailModalの戻る機能が正常動作
- 既存のModal使用箇所に影響なし
- デスクトップ/モバイル両方で適切な表示

### 非機能要件
- 戻るボタンが視認しやすい位置に配置
- タッチ操作に適したボタンサイズ
- アクセシビリティガイドライン準拠

## 完了後の確認事項
1. カレンダーページでの全ユーザーフロー動作確認
2. 他のModal使用箇所での回帰テスト
3. デザインレビュー（UI/UX一貫性確認）
4. パフォーマンス影響評価

## 次のアクション
実装フェーズに移行し、Phase 1から順次実装を開始する。