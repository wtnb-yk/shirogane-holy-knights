# EventDetailModal 外部リンク改善実装計画

## 実装日時
2025-09-27 23:55:00

## 背景と目的
調査結果（`docs/investigate/investigate_20250927_234500.md`）に基づき、EventDetailModalの外部リンク表示を改善する実装計画を策定。現在の問題点（視認性が低い、クリック領域が小さい、位置の一貫性不足）を解決し、ユーザビリティを向上させる。

## 実装方針
**タイトル横スマートアクション方式を採用**
- タイトル右側にExternalLinkアイコンボタンを配置
- 省スペースかつ目立つ位置
- モダンなUIパターンに準拠

## 詳細実装タスク

### フェーズ1: コンポーネント作成（優先度: 高）
#### 1.1 EventExternalLinkButtonコンポーネント新規作成
- **ファイル**: `frontend/src/features/calendar/components/modals/internals/EventExternalLinkButton.tsx`
- **実装内容**:
  ```typescript
  - Props: { url: string }
  - lucide-react の ExternalLink アイコン使用
  - 44x44px のクリック領域（アクセシビリティ基準）
  - aria-label="外部リンクを開く"
  - ツールチップ実装（オプション）
  ```
- **スタイル仕様**:
  ```css
  - 通常時: bg-transparent, text-text-secondary
  - ホバー時: bg-surface-hover, text-accent-gold
  - フォーカス時: ring-2 ring-accent-gold
  - トランジション: transition-all duration-200
  ```

### フェーズ2: 既存コンポーネント修正（優先度: 高）
#### 2.1 EventTitleコンポーネント改修
- **ファイル**: `frontend/src/features/calendar/components/modals/internals/EventTitle.tsx`
- **変更内容**:
  ```typescript
  - Props に event.url を追加
  - タイトル行をflexレイアウトに変更
  - justify-between でタイトルとボタンを配置
  - EventExternalLinkButton を条件付きレンダリング
  ```
- **レイアウト構造**:
  ```
  <div className="flex items-start justify-between gap-2">
    <h3 className="text-2xl font-bold flex-1">タイトル</h3>
    {event.url && <EventExternalLinkButton url={event.url} />}
  </div>
  ```

#### 2.2 EventDescriptionコンポーネント簡素化
- **ファイル**: `frontend/src/features/calendar/components/modals/internals/EventDescription.tsx`
- **変更内容**:
  ```typescript
  - 外部リンク表示ロジックを完全削除
  - LinkText インポートを削除
  - 純粋な説明文表示のみに変更
  - URLの有無判定を削除
  ```

### フェーズ3: テストとバリデーション（優先度: 高）
#### 3.1 E2Eテスト実施
- **ツール**: Playwright MCP
- **テストシナリオ**:
  1. カレンダーページアクセス
  2. イベントクリック → モーダル表示
  3. 外部リンクボタンの表示確認
  4. ボタンホバー時のスタイル変更確認
  5. クリック動作確認（新規タブで開く）
  6. モバイル表示での動作確認

#### 3.2 レスポンシブ確認
- **デスクトップ**: Modal内での表示確認
- **モバイル**: BottomSheet内での表示確認
- **タブレット**: 中間サイズでの表示確認

### フェーズ4: 品質保証（優先度: 中）
#### 4.1 アクセシビリティ確認
- キーボードナビゲーション動作
- スクリーンリーダー対応
- フォーカス表示の明確さ

#### 4.2 パフォーマンス確認
- レンダリング速度
- アニメーション滑らかさ
- メモリリーク確認

## ファイル変更計画

### 新規作成ファイル
| ファイルパス | 目的 |
|-------------|------|
| `frontend/src/features/calendar/components/modals/internals/EventExternalLinkButton.tsx` | 外部リンクボタンコンポーネント |

### 修正ファイル
| ファイルパス | 変更内容 |
|-------------|----------|
| `frontend/src/features/calendar/components/modals/internals/EventTitle.tsx` | レイアウト変更、ボタン追加 |
| `frontend/src/features/calendar/components/modals/internals/EventDescription.tsx` | リンク表示削除、簡素化 |

### 削除対象
なし

## テスト戦略

### 単体テスト
- EventExternalLinkButton: props、クリック動作、スタイル適用
- EventTitle: URLありなしでの表示切り替え
- EventDescription: 説明文のみ表示

### 統合テスト
- EventDetailModal全体: 各コンポーネント連携確認
- ResponsiveModal: デスクトップ/モバイル切り替え

### E2Eテスト
- ユーザーシナリオ全体のフロー確認
- 実際のブラウザでの動作確認
- 異なるデバイスサイズでの表示確認

## リスク分析と対策

### リスク1: 既存の外部リンク機能の破損
- **対策**: 段階的な実装、各ステップでの動作確認

### リスク2: モバイルでのタップ領域不足
- **対策**: 44x44px最小サイズの厳守、実機テスト

### リスク3: アイコンの視認性不足
- **対策**: 適切な色コントラスト、ホバー効果の実装

### リスク4: レスポンシブ対応の不整合
- **対策**: Modal/BottomSheet両方での徹底テスト

## 実装順序
1. EventExternalLinkButtonコンポーネント作成
2. EventTitleコンポーネント修正
3. EventDescriptionコンポーネント簡素化
4. 動作確認（Playwright）
5. 微調整・最適化

## 成功基準
- ✅ 外部リンクボタンがタイトル横に表示される
- ✅ クリック領域が44x44px以上
- ✅ ホバー/フォーカス時の視覚的フィードバック
- ✅ デスクトップ/モバイル両対応
- ✅ アクセシビリティ基準適合
- ✅ 既存機能への影響なし

## 次のステップ
IMPLEMENTフェーズへ移行し、上記計画に従って実装を進める。