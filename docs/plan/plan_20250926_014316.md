# ResponsiveModal実装計画

**策定日時**: 2025-09-26 01:43:16
**対象**: SongDetailModalのレスポンシブデザイン改善
**調査結果参照**: docs/investigate/investigate_20250926_012715.md

## 実装方針決定

### 基本方針
共通コンポーネント「ResponsiveModal」を新規作成し、デスクトップ（1024px以上）ではModal、モバイル（1024px未満）ではBottomSheetを自動切り替えする。useViewportフック（lg:1024px基準）を活用。

### 設計思想
- 単一コンポーネントで両方の表示方法を内包
- 既存のModal、BottomSheetコンポーネントを再利用
- SSRハイドレーション対応
- 共通インターフェースによる使いやすさ

## 詳細実装タスク分解

### Phase 1: ResponsiveModalコンポーネント作成（最高優先度）
1. **基本構造作成**
   - ファイル: `/frontend/src/components/ui/ResponsiveModal.tsx`
   - 基本的なコンポーネント骨格作成

2. **TypeScript定義**
   ```typescript
   interface ResponsiveModalProps {
     isOpen: boolean;
     onClose: () => void;
     children: React.ReactNode;
     title?: ReactNode; // BottomSheet用タイトル
     className?: string;
   }
   ```

3. **画面サイズ判定実装**
   - useViewportフックを使用
   - lg:1024px基準でデスクトップ/モバイル判定
   - デバウンス処理でパフォーマンス最適化

4. **切り替えロジック実装**
   - デスクトップ: Modalコンポーネント使用
   - モバイル: BottomSheetコンポーネント使用
   - props適切な受け渡し

5. **SSRハイドレーション対応**
   - 初回はデスクトップ表示
   - ハイドレーション後に適切な表示に切り替え
   - ちらつき防止

### Phase 2: SongDetailModal置換（高優先度）
1. **ResponsiveModal統合**
   - SongDetailModalでResponsiveModalを使用
   - 既存のpropsとの互換性確保

2. **使用箇所更新**
   - songs/page.tsxでの呼び出し部分確認
   - 必要に応じて修正

## ファイル変更計画

### 新規作成
- `/frontend/src/components/ui/ResponsiveModal.tsx`
  - ResponsiveModalコンポーネント本体
  - TypeScript型定義
  - 画面サイズ判定ロジック
  - Modal/BottomSheet切り替え処理

### 修正予定
- `/frontend/src/features/songs/components/display/modals/SongDetailModal.tsx`
  - ResponsiveModalの使用に変更
  - 既存のModal呼び出しを置換

- `/frontend/src/app/songs/page.tsx`
  - SongDetailModalの使用方法確認
  - 必要に応じてprops調整

## テスト戦略

### 単体テスト
- ResponsiveModalのデスクトップ/モバイル表示切り替え
- 各props（isOpen, onClose, children, title, className）の受け渡し
- useViewportフックによる画面サイズ判定

### 統合テスト
- SongDetailModalでのResponsiveModal動作確認
- 画面サイズ変更時の動的切り替え
- キーボード操作（ESCキー）の統一動作

### E2Eテスト（PlaywrightのMCPツール使用）
- デスクトップ表示でのModal動作確認
- モバイル表示でのBottomSheet動作確認
- 画面サイズ変更時のリアルタイム切り替え
- アクセシビリティ確認（キーボード操作、フォーカス管理）

## リスク分析と対策

### 高リスク: SSRハイドレーション問題
**問題**: サーバー側とクライアント側の表示が異なることによるハイドレーションエラー
**対策**:
- 初回はデスクトップ表示で統一
- useEffectでハイドレーション完了後に適切な表示に切り替え
- 段階的切り替えでちらつき最小化

### 中リスク: パフォーマンス影響
**問題**: useViewportフックによる画面サイズ監視のオーバーヘッド
**対策**:
- デバウンス処理でリサイズイベントの頻度制限
- メモ化でレンダリング最適化

### 低リスク: 既存機能破壊
**問題**: SongDetailModalの既存機能への影響
**対策**:
- 段階的実装（既存機能保持→テスト完了後切り替え）
- 既存propsとの完全互換性確保
- ロールバック計画準備

## 実装スケジュール

### ステップ1: ResponsiveModal作成（推定: 2-3時間）
- 基本構造とTypeScript定義
- 画面サイズ判定ロジック
- Modal/BottomSheet切り替え実装

### ステップ2: SongDetailModal統合（推定: 1-2時間）
- ResponsiveModalの使用に変更
- 既存propsの互換性確認

### ステップ3: テスト実装（推定: 2-3時間）
- 単体テスト、統合テスト作成
- PlaywrightによるE2Eテスト実行

## 期待される成果

### 主要効果
1. **ユーザビリティ向上**: SongDetailModalのモバイル体験大幅改善
2. **開発効率向上**: 共通化による将来の類似実装コスト削減
3. **保守性向上**: レスポンシブデザインの統一とブレークポイント一元管理

### 測定可能な指標
- モバイルでのモーダル操作性改善
- コードの再利用性向上
- 将来の類似コンポーネント開発時間短縮

## 将来展開

### Phase 3: 他コンポーネントへの適用検討
- EventDetailModal等の類似コンポーネント
- 統一されたモーダル体験の実現
- デザインシステムの確立

### 技術的発展性
- タブレット向けの中間サイズ対応
- アニメーション統一
- アクセシビリティ機能強化