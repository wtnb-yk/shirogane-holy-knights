# 実装プラン: DayEventsModal/EventDetailModal モバイル表示改善

## プラン策定日時
2025-10-14 17:33:43

## 調査結果の要約

調査ファイル: `docs/investigate/investigate_20251014_173343.md`

### 現状の問題点
1. **視認性の課題**: BottomSheetは画面下部から展開するため、コンテンツ全体像が初期表示で把握しづらい
2. **情報アーキテクチャの問題**: イベント詳細など、まとまった情報を読む場合にBottomSheetは不適切
3. **ナビゲーションの不明確さ**: DayEventsModal → EventDetailModal の階層的な遷移がBottomSheetでは伝わりにくい

### 影響範囲
- DayEventsModal: イベント一覧表示
- EventDetailModal: イベント詳細表示
- SongDetailModal: 楽曲詳細表示（現状維持を検討）

## 実装方針

**採用する解決策**: ResponsiveModalに`mobileVariant?: 'bottomSheet' | 'fullScreen'`プロパティを追加

### 選定理由
1. ✅ 柔軟性と拡張性が高い
2. ✅ 後方互換性を保ちつつ段階的に改善できる
3. ✅ 各モーダルのコンテンツ特性に応じた最適化が可能
4. ✅ SongDetailModalへの影響を最小限に抑えられる
5. ✅ 既存のResponsiveModalの構造を活かせる（破壊的変更を避けられる）

## 詳細実装タスク

### タスク1: FullScreenModalコンポーネントの作成
**優先度**: 🔴 高

#### 新規作成ファイル
1. `frontend/src/components/FullScreenModal/FullScreenModal.tsx`
2. `frontend/src/components/FullScreenModal/FullScreenModalHeader.tsx`
3. `frontend/src/components/FullScreenModal/index.ts`

#### 実装仕様

##### FullScreenModal.tsx
```typescript
'use client';

import React, { ReactNode } from 'react';
import { cn } from '@/lib/utils';
import { FullScreenModalHeader } from './FullScreenModalHeader';
import { FullScreenModalOverlay } from '@/components/Overlay/Overlay';
import { TAILWIND_Z_INDEX } from '@/constants/zIndex';
import { useViewportHeight } from '@/hooks/useViewportHeight';

interface FullScreenModalProps {
  isOpen: boolean;
  onClose: () => void;
  children: React.ReactNode;
  className?: string;
  title?: ReactNode;
  backButton?: {
    show: boolean;
    onClick: () => void;
  };
}

export const FullScreenModal = ({
  isOpen,
  onClose,
  children,
  className,
  title,
  backButton,
}: FullScreenModalProps) => {
  const { getMaxHeight, isLoaded } = useViewportHeight();

  if (!isOpen) return null;

  // ヘッダー分（約64px）を差し引いた高さを動的に計算
  const maxHeight = isLoaded ? getMaxHeight(64) : 'calc(var(--viewport-height) - 64px)';

  return (
    <>
      {/* 背景オーバーレイ */}
      <FullScreenModalOverlay
        isOpen={isOpen}
        onClose={onClose}
      />

      {/* FullScreenModalコンテンツ */}
      <div
        className={cn(
          `fixed inset-0 w-full bg-bg-primary ${TAILWIND_Z_INDEX.CONTENT.MODAL}`,
          'animate-full-screen-in',
          'flex flex-col',
          'overflow-hidden',
          className
        )}
        style={{
          pointerEvents: 'auto',
          maxHeight: typeof maxHeight === 'number' ? `${maxHeight}px` : maxHeight
        }}
      >
        <FullScreenModalHeader
          title={title}
          onClose={onClose}
          backButton={backButton}
        />
        <div className="flex-1 overflow-y-auto min-h-0">
          <div className="px-4 pb-4">
            <div className="space-y-4">
              {children}
            </div>
          </div>
        </div>
      </div>
    </>
  );
};
```

##### FullScreenModalHeader.tsx
```typescript
'use client';

import React, { ReactNode } from 'react';
import { X, ChevronLeft } from 'lucide-react';
import { IconButton } from '@/components/Button/IconButton';

interface FullScreenModalHeaderProps {
  title: ReactNode;
  onClose: () => void;
  backButton?: {
    show: boolean;
    onClick: () => void;
  };
}

export const FullScreenModalHeader = ({
  title,
  onClose,
  backButton,
}: FullScreenModalHeaderProps) => {
  return (
    <div className="flex items-center justify-between px-4 py-3 border-b border-surface-border">
      <div className="flex items-center gap-2">
        {backButton?.show && (
          <IconButton
            icon={<ChevronLeft className="w-6 h-6" />}
            onClick={backButton.onClick}
            aria-label="戻る"
            size="lg"
            variant="primary-gold"
          />
        )}
        <h2 className="text-lg font-bold text-text-primary">
          {title}
        </h2>
      </div>
      <IconButton
        icon={<X className="w-6 h-6" />}
        onClick={onClose}
        aria-label="閉じる"
        size="lg"
        variant="primary-gold"
      />
    </div>
  );
};
```

##### index.ts
```typescript
export { FullScreenModal } from './FullScreenModal';
export { FullScreenModalHeader } from './FullScreenModalHeader';
```

#### 設計のポイント
- **表示方法**: モバイルで画面全体（`fixed inset-0`）を覆う
- **アニメーション**: `animate-full-screen-in`（画面上部からスライドイン）
- **ヘッダー**: 固定位置、タイトル、戻るボタン、閉じるボタン、下部にボーダー
- **コンテンツ領域**: `flex-1 overflow-y-auto`でスクロール可能
- **背景**: `bg-bg-primary`（白）
- **z-index**: `TAILWIND_Z_INDEX.CONTENT.MODAL`（57）
- **iOS Safari対応**: `useViewportHeight`フックで動的高さ計算

---

### タスク2: アニメーションの追加
**優先度**: 🔴 高

#### 修正ファイル
`frontend/src/app/globals.css`

#### 追加内容
globals.cssの末尾（595行目以降）に以下を追加:

```css
/* FullScreenModal専用アニメーション */
@keyframes fullScreenSlideIn {
  from {
    opacity: 0;
    transform: translateY(-100%);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fullScreenSlideOut {
  from {
    opacity: 1;
    transform: translateY(0);
  }
  to {
    opacity: 0;
    transform: translateY(-100%);
  }
}

.animate-full-screen-in {
  animation: fullScreenSlideIn 350ms cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

.animate-full-screen-out {
  animation: fullScreenSlideOut 250ms ease-in forwards;
}
```

#### 設計のポイント
- **方向**: 上から下にスライドイン（`translateY(-100%)` → `translateY(0)`）
- **時間**: 350ms（入り）、250ms（出）
- **イージング**: `cubic-bezier(0.16, 1, 0.3, 1)`で滑らかな動き
- **GPU加速**: `transform`と`opacity`のみ使用

---

### タスク3: FullScreenModalOverlayの追加
**優先度**: 🔴 高

#### 修正ファイル
`frontend/src/components/Overlay/Overlay.tsx`

#### 追加内容
150行目（BottomSheetOverlay関数の後）に以下を追加:

```typescript
export function FullScreenModalOverlay(props: Omit<OverlayProps, 'zIndex' | 'variant'>) {
  return (
    <Overlay
      {...props}
      zIndex="modal"
      animate={true}
    />
  );
}
```

#### 設計のポイント
- **z-index**: `modal`（50）- ModalOverlayと同じ
- **アニメーション**: `animate={true}`でフェードイン

---

### タスク4: ResponsiveModalの拡張
**優先度**: 🔴 高

#### 修正ファイル
`frontend/src/components/Modal/ResponsiveModal.tsx`

#### 変更内容

##### 1. import文の追加
```typescript
import { FullScreenModal } from '@/components/FullScreenModal';
```

##### 2. interface ResponsiveModalPropsの拡張
8-18行目を以下に変更:

```typescript
interface ResponsiveModalProps {
  isOpen: boolean;
  onClose: () => void;
  children: React.ReactNode;
  title: ReactNode;
  className?: string;
  backButton?: {
    show: boolean;
    onClick: () => void;
  };
  mobileVariant?: 'bottomSheet' | 'fullScreen'; // 新規追加
}
```

##### 3. コンポーネント本体の変更
20-62行目を以下に変更:

```typescript
export const ResponsiveModal = ({
  isOpen,
  onClose,
  children,
  title,
  className = '',
  backButton,
  mobileVariant = 'bottomSheet' // デフォルトは'bottomSheet'（後方互換性）
}: ResponsiveModalProps) => {
  const { isDesktop, isLoaded } = useViewport();

  // SSRハイドレーション対応：初回レンダリング時はデスクトップ表示
  // ハイドレーション完了後に適切な表示に切り替え
  const shouldUseModal = !isLoaded || isDesktop;

  if (shouldUseModal) {
    // デスクトップ表示：Modalコンポーネント使用
    return (
      <Modal
        open={isOpen}
        onOpenChange={(open) => !open && onClose()}
        title={title}
        backButton={backButton}
      >
        <div className={className}>
          {children}
        </div>
      </Modal>
    );
  }

  // モバイル表示：mobileVariantに応じて表示切り替え
  if (mobileVariant === 'fullScreen') {
    return (
      <FullScreenModal
        isOpen={isOpen}
        onClose={onClose}
        title={title}
        className={className}
        backButton={backButton}
      >
        {children}
      </FullScreenModal>
    );
  }

  // デフォルトはBottomSheet
  return (
    <BottomSheet
      isOpen={isOpen}
      onClose={onClose}
      title={title}
      className={className}
      backButton={backButton}
    >
      {children}
    </BottomSheet>
  );
};
```

#### 設計のポイント
- **デフォルト値**: `mobileVariant = 'bottomSheet'`で後方互換性を保つ
- **条件分岐**: デスクトップ → Modal、モバイル＆fullScreen → FullScreenModal、モバイル＆bottomSheet → BottomSheet
- **既存コンポーネント**: mobileVariant指定なし = 従来通りBottomSheet表示

---

### タスク5: DayEventsModalの更新
**優先度**: 🔴 高

#### 修正ファイル
`frontend/src/features/calendar/components/modals/DayEventsModal.tsx`

#### 変更内容
27-38行目のResponsiveModalに`mobileVariant="fullScreen"`を追加:

```typescript
return (
  <ResponsiveModal
    isOpen={isOpen}
    onClose={onClose}
    title={`${date.toLocaleDateString('ja-JP')}のイベント`}
    className={shouldUseDesktopLayout ? "space-y-2 sm:space-y-3 max-h-[85vh] sm:max-h-[90vh] overflow-y-auto" : ""}
    mobileVariant="fullScreen"
  >
    {events.length === 0 ? (
      <EmptyEventsMessage />
    ) : (
      <DayEventsList events={events} onEventClick={onEventClick} />
    )}
  </ResponsiveModal>
);
```

#### 変更理由
イベント一覧は画面全体で見た方が把握しやすく、スクロール可能な領域が広い方がUXが向上する

---

### タスク6: EventDetailModalの更新
**優先度**: 🔴 高

#### 修正ファイル
`frontend/src/features/calendar/components/modals/EventDetailModal.tsx`

#### 変更内容
23-39行目のResponsiveModalに`mobileVariant="fullScreen"`を追加:

```typescript
return (
  <ResponsiveModal
    isOpen={isOpen}
    onClose={onClose}
    title={"イベント詳細"}
    backButton={fromDayModal && onBackToDayModal ? {
      show: true,
      onClick: onBackToDayModal
    } : undefined}
    mobileVariant="fullScreen"
  >
    <div className="space-y-4">
      <EventTitle event={event} />
      <EventImage event={event} />
      <EventTimeInfo event={event} />
      <EventDescription event={event} />
    </div>
  </ResponsiveModal>
);
```

#### 変更理由
詳細情報をしっかり読む用途にはフルスクリーンが適切。画像や説明文を大きく表示できる

---

### タスク7: エクスポート設定の更新
**優先度**: 🟡 中

#### 修正ファイル
`frontend/src/components/Modal/index.ts`

#### 変更内容
FullScreenModalのエクスポートを追加:

```typescript
export { Modal } from './Modal';
export { ModalHeader } from './ModalHeader';
export { ResponsiveModal } from './ResponsiveModal';
export { FullScreenModal } from '@/components/FullScreenModal';
export { FullScreenModalHeader } from '@/components/FullScreenModal';
```

#### 変更理由
他のコンポーネントから直接FullScreenModalをimportできるようにする

---

### タスク8: SongDetailModalの検証と判断
**優先度**: 🟡 中（E2Eテスト後に判断）

#### 対象ファイル
`frontend/src/features/songs/components/modals/SongDetailModal.tsx`

#### 現状
- `mobileVariant`指定なし = BottomSheet表示（現状維持）

#### 検証内容
E2Eテストで以下を確認:
1. BottomSheetでのパフォーマンスリスト表示が適切か
2. スクロール動作に問題がないか
3. ユーザー体験として改善の余地があるか

#### 判断基準
- パフォーマンス数が多い場合、FullScreenの方が見やすい可能性
- BottomSheetのまま問題なければ現状維持
- 必要に応じて`mobileVariant="fullScreen"`を追加

---

## ファイル変更計画

### 新規作成（3ファイル）
1. ✨ `frontend/src/components/FullScreenModal/FullScreenModal.tsx`
2. ✨ `frontend/src/components/FullScreenModal/FullScreenModalHeader.tsx`
3. ✨ `frontend/src/components/FullScreenModal/index.ts`

### 修正（6ファイル + 1ファイル任意）
1. ✏️ `frontend/src/app/globals.css` - アニメーション追加
2. ✏️ `frontend/src/components/Overlay/Overlay.tsx` - FullScreenModalOverlay追加
3. ✏️ `frontend/src/components/Modal/ResponsiveModal.tsx` - mobileVariant追加
4. ✏️ `frontend/src/components/Modal/index.ts` - エクスポート追加
5. ✏️ `frontend/src/features/calendar/components/modals/DayEventsModal.tsx` - mobileVariant指定
6. ✏️ `frontend/src/features/calendar/components/modals/EventDetailModal.tsx` - mobileVariant指定
7. ❓ `frontend/src/features/songs/components/modals/SongDetailModal.tsx` - 検証後に判断

---

## テスト戦略

### E2Eテスト（Playwright - 必須）

#### テストシナリオ1: DayEventsModalのフルスクリーン表示
```typescript
test('DayEventsModal displays as full screen on mobile', async ({ page }) => {
  // 1. モバイルサイズに設定
  await page.setViewportSize({ width: 375, height: 667 });

  // 2. アプリを開く
  await page.goto('http://localhost:3001');

  // 3. カレンダーから日付をクリック
  await page.click('[data-testid="calendar-day"]');

  // 4. フルスクリーンモーダルが表示されることを確認
  const modal = await page.locator('[class*="animate-full-screen-in"]');
  await expect(modal).toBeVisible();

  // 5. タイトルとイベントリストが表示されることを確認
  await expect(page.locator('text=のイベント')).toBeVisible();

  // 6. スクロール可能であることを確認
  const scrollContainer = modal.locator('.overflow-y-auto');
  await expect(scrollContainer).toBeVisible();

  // 7. 閉じるボタンで閉じることを確認
  await page.click('[aria-label="閉じる"]');
  await expect(modal).not.toBeVisible();
});
```

#### テストシナリオ2: EventDetailModalへの遷移と戻る
```typescript
test('Navigate from DayEventsModal to EventDetailModal and back', async ({ page }) => {
  // 1. モバイルサイズに設定
  await page.setViewportSize({ width: 375, height: 667 });

  // 2. DayEventsModalを開く
  await page.goto('http://localhost:3001');
  await page.click('[data-testid="calendar-day"]');

  // 3. イベントをクリック
  await page.click('[data-testid="event-item"]');

  // 4. EventDetailModalがフルスクリーンで表示されることを確認
  await expect(page.locator('text=イベント詳細')).toBeVisible();

  // 5. イベント詳細が表示されることを確認
  await expect(page.locator('[data-testid="event-title"]')).toBeVisible();
  await expect(page.locator('[data-testid="event-image"]')).toBeVisible();

  // 6. 戻るボタンでDayEventsModalに戻ることを確認
  await page.click('[aria-label="戻る"]');
  await expect(page.locator('text=のイベント')).toBeVisible();

  // 7. 閉じるボタンで全て閉じることを確認
  await page.click('[aria-label="閉じる"]');
});
```

#### テストシナリオ3: SongDetailModalの現状維持確認
```typescript
test('SongDetailModal displays as bottom sheet on mobile', async ({ page }) => {
  // 1. モバイルサイズに設定
  await page.setViewportSize({ width: 375, height: 667 });

  // 2. 楽曲リストページを開く
  await page.goto('http://localhost:3001/songs');

  // 3. 楽曲をクリック
  await page.click('[data-testid="song-item"]');

  // 4. BottomSheetとして表示されることを確認
  const bottomSheet = await page.locator('[class*="animate-bottom-sheet-in"]');
  await expect(bottomSheet).toBeVisible();

  // 5. 楽曲詳細が表示されることを確認
  await expect(page.locator('text=楽曲詳細')).toBeVisible();

  // 6. パフォーマンスリストが表示されることを確認
  await expect(page.locator('[data-testid="performance-list"]')).toBeVisible();

  // 7. 正常に動作することを確認
  await page.click('[aria-label="閉じる"]');
  await expect(bottomSheet).not.toBeVisible();
});
```

#### テストシナリオ4: デスクトップ表示の回帰テスト
```typescript
test('All modals display as centered modal on desktop', async ({ page }) => {
  // 1. デスクトップサイズに設定
  await page.setViewportSize({ width: 1280, height: 720 });

  // 2. DayEventsModalをテスト
  await page.goto('http://localhost:3001');
  await page.click('[data-testid="calendar-day"]');
  let modal = await page.locator('[class*="animate-modal-slide-scale"]');
  await expect(modal).toBeVisible();
  await page.click('[aria-label="閉じる"]');

  // 3. EventDetailModalをテスト
  await page.click('[data-testid="calendar-day"]');
  await page.click('[data-testid="event-item"]');
  await expect(page.locator('text=イベント詳細')).toBeVisible();
  await page.click('[aria-label="閉じる"]');

  // 4. SongDetailModalをテスト
  await page.goto('http://localhost:3001/songs');
  await page.click('[data-testid="song-item"]');
  modal = await page.locator('[class*="animate-modal-slide-scale"]');
  await expect(modal).toBeVisible();
  await page.click('[aria-label="閉じる"]');
});
```

### テスト実行手順
1. 実装完了後、Playwright MCPツールを使用してテストを実行
2. モバイルサイズ（375x667）とデスクトップサイズ（1280x720）で確認
3. スクリーンショットを撮影して視覚的に確認
4. iOS Safari実機でも確認（可能であれば）

---

## リスク分析と対策

### リスク1: アニメーション性能
- **影響度**: 🟡 中
- **発生確率**: 低
- **影響範囲**: モバイルデバイスでのアニメーション性能
- **対策**:
  - CSS `transform`と`opacity`のみ使用（GPU加速が効く）
  - `cubic-bezier`関数で滑らかな動き
  - アニメーション時間を350ms/250msに最適化
- **検証方法**: モバイル実機でのパフォーマンステスト、Chrome DevToolsのPerformanceタブで確認
- **フォールバック**: パフォーマンス問題が発生した場合は`transition`を使用した簡易版に変更

### リスク2: iOS Safariでの表示崩れ
- **影響度**: 🔴 高
- **発生確率**: 中
- **影響範囲**: iOS Safariユーザーの表示
- **対策**:
  - `useViewportHeight`フックで動的高さ計算
  - `--viewport-height` CSS変数を使用
  - `100vh`ではなく実際のビューポート高さを使用
  - アドレスバーの表示/非表示に対応
- **検証方法**: iOS Safari実機でのテスト（iPhone各サイズ）
- **フォールバック**: 表示崩れが発生した場合は`100dvh`（動的ビューポート高さ）を使用

### リスク3: 既存コンポーネントへの影響
- **影響度**: 🟢 低
- **発生確率**: 低
- **影響範囲**: ResponsiveModalを使用している全コンポーネント
- **対策**:
  - デフォルト値を`'bottomSheet'`にして後方互換性を保つ
  - `mobileVariant`を指定しない場合は従来通りの動作
  - TypeScript型定義で安全性を確保
- **検証方法**: 全モーダルコンポーネント（DayEvents、EventDetail、SongDetail、SearchOptions等）の動作確認
- **フォールバック**: 問題が発生した場合は該当コンポーネントで`mobileVariant="bottomSheet"`を明示的に指定

### リスク4: z-indexの競合
- **影響度**: 🟢 低
- **発生確率**: 低
- **影響範囲**: 複数モーダルの同時表示
- **対策**:
  - 既存の`zIndex.ts`定数を活用
  - FullScreenModalはModalと同じz-index（57）を使用
  - オーバーレイも既存のMODAL（50）を使用
- **検証方法**: 複数モーダルの同時表示テスト（DayEvents → EventDetailの遷移など）
- **フォールバック**: 競合が発生した場合はz-indexを58に変更

### リスク5: SSRハイドレーション不一致
- **影響度**: 🟡 中
- **発生確率**: 低
- **影響範囲**: Next.jsのSSR/ハイドレーション
- **対策**:
  - ResponsiveModalで既に実装済みの`isLoaded`パターンを踏襲
  - 初回レンダリング時はデスクトップ表示、ハイドレーション完了後に適切な表示に切り替え
  - `useEffect`でクライアントサイドのみで動作するコードを隔離
- **検証方法**: Next.jsの本番ビルド＆実行でハイドレーション警告が出ないか確認
- **フォールバック**: 警告が出る場合は`suppressHydrationWarning`を使用

---

## 実装順序

### フェーズ1: 基礎コンポーネント作成（所要時間: 30分）
1. ✅ FullScreenModal.tsx作成
2. ✅ FullScreenModalHeader.tsx作成
3. ✅ index.ts作成
4. ✅ globals.cssにアニメーション追加
5. ✅ Overlay.tsxにFullScreenModalOverlay追加

### フェーズ2: ResponsiveModal拡張（所要時間: 15分）
6. ✅ ResponsiveModal.tsxを拡張
7. ✅ Modal/index.tsにエクスポート追加

### フェーズ3: モーダルコンポーネント更新（所要時間: 10分）
8. ✅ DayEventsModal.tsxを更新
9. ✅ EventDetailModal.tsxを更新

### フェーズ4: E2Eテスト実施（所要時間: 45分）
10. ✅ テストシナリオ1: DayEventsModalのフルスクリーン表示
11. ✅ テストシナリオ2: EventDetailModalへの遷移と戻る
12. ✅ テストシナリオ3: SongDetailModalの現状維持確認
13. ✅ テストシナリオ4: デスクトップ表示の回帰テスト

### フェーズ5: モバイル実機確認（所要時間: 30分）
14. ✅ iOS Safari実機テスト
15. ✅ Android Chrome実機テスト
16. ✅ 視覚的な確認とスクリーンショット撮影

### フェーズ6: 任意対応（所要時間: 15分）
17. ❓ SongDetailModalのフルスクリーン化判断
18. ❓ 必要に応じてSongDetailModal.tsxを更新

**合計所要時間**: 約2時間30分

---

## 期待される成果

### 1. 視認性の向上
- ✅ イベント情報が画面全体で表示され、一覧性が向上
- ✅ スクロール可能な領域が広がり、コンテンツの全体像を把握しやすくなる
- ✅ 画像や説明文が大きく表示され、詳細情報が読みやすくなる

### 2. ナビゲーションの明確化
- ✅ フルスクリーン表示により、モーダル階層が明確に
- ✅ 戻るボタンの視認性が向上し、操作フローが理解しやすくなる
- ✅ DayEventsModal ⇄ EventDetailModalの遷移が自然になる

### 3. コンテンツの読みやすさ向上
- ✅ 固定ヘッダーとスクロール可能な本文で情報が整理される
- ✅ イベント一覧やイベント詳細を集中して閲覧できる
- ✅ BottomSheetの「引き上げる」操作が不要になり、ストレスが減少

### 4. 柔軟性の確保
- ✅ 各モーダルで最適な表示方法を選択可能
- ✅ 将来的に他のモーダルも簡単にフルスクリーン化できる
- ✅ `mobileVariant`プロパティで拡張性を確保

### 5. 後方互換性の維持
- ✅ 既存のBottomSheetを使用するコンポーネントに影響なし
- ✅ SongDetailModalなど、BottomSheetのままで問題ないコンポーネントは現状維持
- ✅ デスクトップ表示は変更なし（中央モーダル表示）

### 6. 保守性の向上
- ✅ ResponsiveModalの責務が明確化
- ✅ コンポーネント構成が統一され、保守しやすくなる
- ✅ 将来的な機能追加（例: `mobileVariant='drawer'`など）が容易

---

## 成功基準

### 機能要件
- ✅ DayEventsModalがモバイルでフルスクリーン表示される
- ✅ EventDetailModalがモバイルでフルスクリーン表示される
- ✅ 戻るボタンでDayEventsModalに戻れる
- ✅ 閉じるボタンで全て閉じられる
- ✅ デスクトップでは従来通り中央モーダル表示される
- ✅ SongDetailModalはBottomSheetのまま正常動作する

### 非機能要件
- ✅ アニメーションが滑らかに動作する（60fps維持）
- ✅ iOS Safariで表示崩れがない
- ✅ スクロールが正常に動作する
- ✅ ハイドレーション警告が出ない
- ✅ 既存のモーダルコンポーネントに影響がない

### UX要件
- ✅ イベント情報が見やすくなる
- ✅ モーダル階層が明確になる
- ✅ 操作フローが自然になる
- ✅ ストレスなく情報を閲覧できる

---

## 備考

### 技術的な考慮事項
- **TypeScript**: 型安全性を維持しながら拡張
- **CSS**: Tailwind CSS v4とglobals.cssの組み合わせ
- **アニメーション**: CSS Animationsを使用（JavaScript不使用）
- **アクセシビリティ**: aria-labelでスクリーンリーダー対応
- **パフォーマンス**: GPU加速を活用した軽量なアニメーション

### 今後の拡張可能性
- `mobileVariant='drawer'`: 横からスライドインするドロワー型
- `mobileVariant='popup'`: 中央に表示されるポップアップ型
- `headerPosition='sticky' | 'fixed'`: ヘッダーの固定方法を選択
- `gestureClose`: スワイプで閉じる機能

### 参考資料
- 調査レポート: `docs/investigate/investigate_20251014_173343.md`
- ResponsiveModal実装: `frontend/src/components/Modal/ResponsiveModal.tsx`
- BottomSheet実装: `frontend/src/components/BottomSheet/BottomSheet.tsx`
- Modal実装: `frontend/src/components/Modal/Modal.tsx`