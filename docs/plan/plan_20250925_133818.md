# 実装計画書: ResponsiveSidebar APIの統一化

**日時:** 2025/09/25 13:38:18
**ブランチ:** feature/sidebar-refactor
**対象コンポーネント:** ResponsiveSidebar, FilterableSidebar, 各ページのSidebarコンポーネント

## 1. 実装方針

### 1.1 基本方針
- **APIの統一化**: デスクトップとモバイルで一貫性のあるインターフェース
- **責務の明確化**: ResponsiveSidebarがラッピングの責務を持つ
- **段階的リファクタリング**: 既存機能を維持しながら段階的に改善

### 1.2 技術方針
- TypeScriptの型安全性を最大限活用
- 既存のUIコンポーネントの継続利用
- レスポンシブデザインの維持

## 2. 詳細実装タスク

### フェーズ1: ResponsiveSidebarコンポーネントの改修（優先度: 高）

#### タスク1.1: ResponsiveSidebar APIの変更
```typescript
// 変更前
interface ResponsiveSidebarProps {
  isOpen: boolean;
  onClose: () => void;
  children: React.ReactNode;      // サイドバー全体
  mobileContent: React.ReactNode;  // コンテンツのみ
  bottomSheetTitle?: string;
  className?: string;
}

// 変更後
interface ResponsiveSidebarProps {
  isOpen: boolean;
  onClose: () => void;
  desktopContent: React.ReactNode;  // コンテンツのみ
  mobileContent: React.ReactNode;   // コンテンツのみ
  bottomSheetTitle?: string;
  className?: string;
  sidebarClassName?: string;        // デスクトップサイドバー用のクラス
}
```

実装内容：
- `children`を`desktopContent`に変更
- デスクトップ版でGenericSidebarでラップ
- モバイル版の処理は現状維持

#### タスク1.2: FilterableSidebarの責務整理
- GenericSidebarのラップ処理を削除
- セクションのレンダリングのみに専念
- ResponsiveSidebarから呼び出される形に変更

### フェーズ2: 各ページの段階的更新（優先度: 高）

#### タスク2.1: Calendarページの更新
```tsx
// 変更前
<ResponsiveSidebar
  isOpen={isSidebarOpen}
  onClose={() => setIsSidebarOpen(false)}
  mobileContent={<CalendarBottomSheetContent ... />}
>
  <CalendarSidebar ... />  // FilterableSidebar → GenericSidebar含む
</ResponsiveSidebar>

// 変更後
<ResponsiveSidebar
  isOpen={isSidebarOpen}
  onClose={() => setIsSidebarOpen(false)}
  desktopContent={<CalendarSidebarContent ... />}  // コンテンツのみ
  mobileContent={<CalendarBottomSheetContent ... />}
/>
```

#### タスク2.2: Songsページの更新
- 同様のパターンで更新
- SongsSidebarの内容をコンテンツ化

#### タスク2.3: Newsページの更新
- 同様のパターンで更新
- NewsSidebarの内容をコンテンツ化

#### タスク2.4: Discographyページの更新
- 同様のパターンで更新
- DiscographySidebarの内容をコンテンツ化

#### タスク2.5: Archivesページの更新
- 同様のパターンで更新
- ArchivesSidebarの内容をコンテンツ化

### フェーズ3: クリーンアップと最適化（優先度: 中）

#### タスク3.1: 不要なコンポーネントの削除
- 各XxxSidebarコンポーネントの統合検討
- BottomSheetContentとの共通化

#### タスク3.2: 共通コンポーネント化
- デスクトップとモバイルで共通のコンテンツコンポーネント作成

## 3. ファイル変更計画

### 新規作成ファイル（0ファイル）
なし（既存ファイルの修正で対応）

### 修正ファイル（12ファイル）
```
frontend/src/components/common/Sidebar/
├── ResponsiveSidebar.tsx
└── FilterableSidebar.tsx

frontend/src/app/
├── calendar/page.tsx
├── songs/page.tsx
├── news/page.tsx
├── discography/page.tsx
└── archives/page.tsx

frontend/src/features/
├── calendar/components/CalendarSidebar.tsx
├── songs/components/layout/SongsSidebar.tsx
├── news/components/NewsSidebar.tsx
├── discography/components/DiscographySidebar.tsx
└── archives/components/ArchivesSidebar.tsx
```

### 削除ファイル（検討中）
- 必要に応じて統合後の不要コンポーネント

## 4. テスト戦略

### 4.1 E2Eテスト（Playwright）
各ページで以下を確認：
1. デスクトップ版（1920x1080）
   - サイドバーが正しく表示される
   - フィルタリング機能が動作する
2. モバイル版（375x667）
   - BottomSheetが正しく開閉する
   - フィルタリング機能が動作する
3. レスポンシブ切り替え（1024px境界）
   - 表示が適切に切り替わる

### 4.2 統合テスト
- 各ページのフィルタリング動作確認
- ページ間の一貫性確認

### 4.3 ビルド確認
```bash
cd frontend
pnpm build
pnpm typecheck
pnpm lint
```

## 5. リスク分析と対策

### リスク1: 既存機能の破損
**影響度:** 高
**発生確率:** 中
**対策:**
- 段階的な実装（ページごと）
- 各ステップでのE2Eテスト実行
- 開発サーバーでの動作確認

### リスク2: TypeScript型エラー
**影響度:** 中
**発生確率:** 中
**対策:**
- 型定義の明確化
- 段階的なビルド確認
- 必要に応じて型の互換性維持

### リスク3: レイアウトの崩れ
**影響度:** 中
**発生確率:** 低
**対策:**
- 既存のCSSクラスの維持
- Playwrightによる視覚的確認
- 各ブレークポイントでの確認

### リスク4: パフォーマンスへの影響
**影響度:** 低
**発生確率:** 低
**対策:**
- 不要な再レンダリングの防止
- React.memoの適切な使用

## 6. 実装スケジュール

### Day 1（3-4時間）
- フェーズ1: ResponsiveSidebarの改修
- フェーズ2: Calendarページの更新とテスト

### Day 2（3-4時間）
- フェーズ2: 残り4ページの更新
- 各ページのE2Eテスト

### Day 3（2時間）
- フェーズ3: クリーンアップ
- 全体の動作確認とビルドテスト

## 7. 成功指標

### 定量的指標
- 全5ページでの統一API使用: 100%
- TypeScriptビルドエラー: 0件
- E2Eテスト成功率: 100%
- コード重複削減: 約20-30%

### 定性的指標
- APIの一貫性が向上
- コンポーネントの責務が明確化
- 保守性が向上
- 将来の拡張が容易

## 8. 次のステップ

本実装計画に基づいて、IMPLEMENTフェーズに移行し、フェーズ1から順次実装を開始する。

各フェーズ完了後は必ず以下を実施：
1. TypeScriptビルド確認
2. Playwrightによる動作確認
3. Gitでのコミット（フェーズ単位）

## 9. 備考

- 現在のブランチ: `feature/sidebar-refactor`（実装準備完了）
- 開発サーバー起動中: `http://localhost:3001`
- 影響範囲が広いため、慎重な実装とテストが必要

## 10. 結論

ResponsiveSidebarのAPI統一により、コードベースの一貫性と保守性が大幅に向上する。段階的な実装とテストにより、リスクを最小限に抑えながら確実な改善を実現する。